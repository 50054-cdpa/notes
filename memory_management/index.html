
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Notes for SUTD's CDPA 50.054">
      
      
        <meta name="author" content="Kenny Lu">
      
      
      
        <link rel="prev" href="../advanced_static_analysis/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.17">
    
    
      
        <title>Memory Management - Compiler Design and Program Analysis 50.054</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.bcfcd587.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      
  
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
    
    
  
  
  <style>:root{--md-admonition-icon--abstract:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.5 1.75v11.5c0 .138.112.25.25.25h3.17a.75.75 0 0 1 0 1.5H2.75A1.75 1.75 0 0 1 1 13.25V1.75C1 .784 1.784 0 2.75 0h8.5C12.216 0 13 .784 13 1.75v7.736a.75.75 0 0 1-1.5 0V1.75a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Zm13.274 9.537v-.001l-4.557 4.45a.75.75 0 0 1-1.055-.008l-1.943-1.95a.75.75 0 0 1 1.062-1.058l1.419 1.425 4.026-3.932a.75.75 0 1 1 1.048 1.074ZM4.75 4h4.5a.75.75 0 0 1 0 1.5h-4.5a.75.75 0 0 1 0-1.5ZM4 7.75A.75.75 0 0 1 4.75 7h2a.75.75 0 0 1 0 1.5h-2A.75.75 0 0 1 4 7.75Z"/></svg>');--md-admonition-icon--bug:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M4.72.22a.75.75 0 0 1 1.06 0l1 .999a3.488 3.488 0 0 1 2.441 0l.999-1a.748.748 0 0 1 1.265.332.75.75 0 0 1-.205.729l-.775.776c.616.63.995 1.493.995 2.444v.327c0 .1-.009.197-.025.292.408.14.764.392 1.029.722l1.968-.787a.75.75 0 0 1 .556 1.392L13 7.258V9h2.25a.75.75 0 0 1 0 1.5H13v.5c0 .409-.049.806-.141 1.186l2.17.868a.75.75 0 0 1-.557 1.392l-2.184-.873A4.997 4.997 0 0 1 8 16a4.997 4.997 0 0 1-4.288-2.427l-2.183.873a.75.75 0 0 1-.558-1.392l2.17-.868A5.036 5.036 0 0 1 3 11v-.5H.75a.75.75 0 0 1 0-1.5H3V7.258L.971 6.446a.75.75 0 0 1 .558-1.392l1.967.787c.265-.33.62-.583 1.03-.722a1.677 1.677 0 0 1-.026-.292V4.5c0-.951.38-1.814.995-2.444L4.72 1.28a.75.75 0 0 1 0-1.06Zm.53 6.28a.75.75 0 0 0-.75.75V11a3.5 3.5 0 1 0 7 0V7.25a.75.75 0 0 0-.75-.75ZM6.173 5h3.654A.172.172 0 0 0 10 4.827V4.5a2 2 0 1 0-4 0v.327c0 .096.077.173.173.173Z"/></svg>');--md-admonition-icon--danger:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M9.504.43a1.516 1.516 0 0 1 2.437 1.713L10.415 5.5h2.123c1.57 0 2.346 1.909 1.22 3.004l-7.34 7.142a1.249 1.249 0 0 1-.871.354h-.302a1.25 1.25 0 0 1-1.157-1.723L5.633 10.5H3.462c-1.57 0-2.346-1.909-1.22-3.004L9.503.429Zm1.047 1.074L3.286 8.571A.25.25 0 0 0 3.462 9H6.75a.75.75 0 0 1 .694 1.034l-1.713 4.188 6.982-6.793A.25.25 0 0 0 12.538 7H9.25a.75.75 0 0 1-.683-1.06l2.008-4.418.003-.006a.036.036 0 0 0-.004-.009l-.006-.006-.008-.001c-.003 0-.006.002-.009.004Z"/></svg>');--md-admonition-icon--example:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.782V2.5h-.25a.75.75 0 0 1 0-1.5h6.5a.75.75 0 0 1 0 1.5H11v3.282l3.666 5.76C15.619 13.04 14.543 15 12.767 15H3.233c-1.776 0-2.852-1.96-1.899-3.458Zm-2.4 6.565a.75.75 0 0 0 .633 1.153h9.534a.75.75 0 0 0 .633-1.153L12.225 10.5h-8.45ZM9.5 2.5h-3V6c0 .143-.04.283-.117.403L4.73 9h6.54L9.617 6.403A.746.746 0 0 1 9.5 6Z"/></svg>');--md-admonition-icon--failure:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M2.344 2.343h-.001a8 8 0 0 1 11.314 11.314A8.002 8.002 0 0 1 .234 10.089a8 8 0 0 1 2.11-7.746Zm1.06 10.253a6.5 6.5 0 1 0 9.108-9.275 6.5 6.5 0 0 0-9.108 9.275ZM6.03 4.97 8 6.94l1.97-1.97a.749.749 0 0 1 1.275.326.749.749 0 0 1-.215.734L9.06 8l1.97 1.97a.749.749 0 0 1-.326 1.275.749.749 0 0 1-.734-.215L8 9.06l-1.97 1.97a.749.749 0 0 1-1.275-.326.749.749 0 0 1 .215-.734L6.94 8 4.97 6.03a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018Z"/></svg>');--md-admonition-icon--info:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"/></svg>');--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1 7.775V2.75C1 1.784 1.784 1 2.75 1h5.025c.464 0 .91.184 1.238.513l6.25 6.25a1.75 1.75 0 0 1 0 2.474l-5.026 5.026a1.75 1.75 0 0 1-2.474 0l-6.25-6.25A1.752 1.752 0 0 1 1 7.775Zm1.5 0c0 .066.026.13.073.177l6.25 6.25a.25.25 0 0 0 .354 0l5.025-5.025a.25.25 0 0 0 0-.354l-6.25-6.25a.25.25 0 0 0-.177-.073H2.75a.25.25 0 0 0-.25.25ZM6 5a1 1 0 1 1 0 2 1 1 0 0 1 0-2Z"/></svg>');--md-admonition-icon--success:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M13.78 4.22a.75.75 0 0 1 0 1.06l-7.25 7.25a.75.75 0 0 1-1.06 0L2.22 9.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018L6 10.94l6.72-6.72a.75.75 0 0 1 1.06 0Z"/></svg>');--md-admonition-icon--tip:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M3.499.75a.75.75 0 0 1 1.5 0v.996C5.9 2.903 6.793 3.65 7.662 4.376l.24.202c-.036-.694.055-1.422.426-2.163C9.1.873 10.794-.045 12.622.26 14.408.558 16 1.94 16 4.25c0 1.278-.954 2.575-2.44 2.734l.146.508.065.22c.203.701.412 1.455.476 2.226.142 1.707-.4 3.03-1.487 3.898C11.714 14.671 10.27 15 8.75 15h-6a.75.75 0 0 1 0-1.5h1.376a4.484 4.484 0 0 1-.563-1.191 3.835 3.835 0 0 1-.05-2.063 4.647 4.647 0 0 1-2.025-.293.75.75 0 0 1 .525-1.406c1.357.507 2.376-.006 2.698-.318l.009-.01a.747.747 0 0 1 1.06 0 .748.748 0 0 1-.012 1.074c-.912.92-.992 1.835-.768 2.586.221.74.745 1.337 1.196 1.621H8.75c1.343 0 2.398-.296 3.074-.836.635-.507 1.036-1.31.928-2.602-.05-.603-.216-1.224-.422-1.93l-.064-.221c-.12-.407-.246-.84-.353-1.29a2.425 2.425 0 0 1-.507-.441 3.075 3.075 0 0 1-.633-1.248.75.75 0 0 1 1.455-.364c.046.185.144.436.31.627.146.168.353.305.712.305.738 0 1.25-.615 1.25-1.25 0-1.47-.95-2.315-2.123-2.51-1.172-.196-2.227.387-2.706 1.345-.46.92-.27 1.774.019 3.062l.042.19a.884.884 0 0 1 .01.05c.348.443.666.949.94 1.553a.75.75 0 1 1-1.365.62c-.553-1.217-1.32-1.94-2.3-2.768L6.7 5.527c-.814-.68-1.75-1.462-2.692-2.619a3.737 3.737 0 0 0-1.023.88c-.406.495-.663 1.036-.722 1.508.116.122.306.21.591.239.388.038.797-.06 1.032-.19a.75.75 0 0 1 .728 1.31c-.515.287-1.23.439-1.906.373-.682-.067-1.473-.38-1.879-1.193L.75 5.677V5.5c0-.984.48-1.94 1.077-2.664.46-.559 1.05-1.055 1.673-1.353V.75Z"/></svg>');--md-admonition-icon--question:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.92 6.085h.001a.749.749 0 1 1-1.342-.67c.169-.339.436-.701.849-.977C6.845 4.16 7.369 4 8 4a2.756 2.756 0 0 1 1.637.525c.503.377.863.965.863 1.725 0 .448-.115.83-.329 1.15-.205.307-.47.513-.692.662-.109.072-.22.138-.313.195l-.006.004a6.24 6.24 0 0 0-.26.16.952.952 0 0 0-.276.245.75.75 0 0 1-1.248-.832c.184-.264.42-.489.692-.661.103-.067.207-.132.313-.195l.007-.004c.1-.061.182-.11.258-.161a.969.969 0 0 0 .277-.245C8.96 6.514 9 6.427 9 6.25a.612.612 0 0 0-.262-.525A1.27 1.27 0 0 0 8 5.5c-.369 0-.595.09-.74.187a1.01 1.01 0 0 0-.34.398ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');--md-admonition-icon--quote:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M1.75 2.5h10.5a.75.75 0 0 1 0 1.5H1.75a.75.75 0 0 1 0-1.5Zm4 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5Zm0 5h8.5a.75.75 0 0 1 0 1.5h-8.5a.75.75 0 0 1 0-1.5ZM2.5 7.75v6a.75.75 0 0 1-1.5 0v-6a.75.75 0 0 1 1.5 0Z"/></svg>');--md-admonition-icon--warning:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M6.457 1.047c.659-1.234 2.427-1.234 3.086 0l6.082 11.378A1.75 1.75 0 0 1 14.082 15H1.918a1.75 1.75 0 0 1-1.543-2.575Zm1.763.707a.25.25 0 0 0-.44 0L1.698 13.132a.25.25 0 0 0 .22.368h12.164a.25.25 0 0 0 .22-.368Zm.53 3.996v2.5a.75.75 0 0 1-1.5 0v-2.5a.75.75 0 0 1 1.5 0ZM9 11a1 1 0 1 1-2 0 1 1 0 0 1 2 0Z"/></svg>');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CSpline+Sans+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Spline Sans Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#50054-memory-management" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Compiler Design and Program Analysis 50.054" class="md-header__button md-logo" aria-label="Compiler Design and Program Analysis 50.054" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"/><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Compiler Design and Program Analysis 50.054
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Memory Management
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="indigo"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/50054-cdpa/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    50054-cdpa
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../handout/" class="md-tabs__link">
        
  
    
  
  Handout

      </a>
    </li>
  

      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../schedule/" class="md-tabs__link">
        
  
    
  
  Schedule

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../introduction/" class="md-tabs__link">
          
  
    
  
  W1

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../fp_scala/" class="md-tabs__link">
          
  
    
  
  W2

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../fp_scala_poly/" class="md-tabs__link">
          
  
    
  
  W3

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../fp_applicative_monad/" class="md-tabs__link">
          
  
    
  
  W4

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../syntax_analysis/" class="md-tabs__link">
          
  
    
  
  W5

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../syntax_analysis_parser_combinator/" class="md-tabs__link">
          
  
    
  
  W6

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../semantic_analysis/" class="md-tabs__link">
          
  
    
  
  W8

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../static_semantics/" class="md-tabs__link">
          
  
    
  
  W9

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../name_analysis/" class="md-tabs__link">
          
  
    
  
  W10

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../sign_analysis_lattice/" class="md-tabs__link">
          
  
    
  
  W11

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../code_generation/" class="md-tabs__link">
          
  
    
  
  W12

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="./" class="md-tabs__link">
          
  
    
  
  W13

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Compiler Design and Program Analysis 50.054" class="md-nav__button md-logo" aria-label="Compiler Design and Program Analysis 50.054" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 3a2 2 0 0 1 2-2h9.982a2 2 0 0 1 1.414.586l4.018 4.018A2 2 0 0 1 21 7.018V21a2 2 0 0 1-2 2H4.75a.75.75 0 0 1 0-1.5H19a.5.5 0 0 0 .5-.5V8.5h-4a2 2 0 0 1-2-2v-4H5a.5.5 0 0 0-.5.5v6.25a.75.75 0 0 1-1.5 0Zm12-.5v4a.5.5 0 0 0 .5.5h4a.5.5 0 0 0-.146-.336l-4.018-4.018A.5.5 0 0 0 15 2.5Z"/><path d="M4.53 12.24a.75.75 0 0 1-.039 1.06l-2.639 2.45 2.64 2.45a.75.75 0 1 1-1.022 1.1l-3.23-3a.75.75 0 0 1 0-1.1l3.23-3a.75.75 0 0 1 1.06.04Zm3.979 1.06a.75.75 0 1 1 1.02-1.1l3.231 3a.75.75 0 0 1 0 1.1l-3.23 3a.75.75 0 1 1-1.021-1.1l2.639-2.45-2.64-2.45Z"/></svg>

    </a>
    Compiler Design and Program Analysis 50.054
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/50054-cdpa/notes" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    50054-cdpa
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../handout/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Handout
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../schedule/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Schedule
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W1
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            W1
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Intro
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fp_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FP Intro
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W2
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            W2
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fp_scala/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FP Scala
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W3
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            W3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fp_scala_poly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FP Scala Polymorphic
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W4
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            W4
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fp_applicative_monad/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    FP Applicative Monads
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W5
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            W5
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../syntax_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Syntax Analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W6
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            W6
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../syntax_analysis_parser_combinator/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Syntax Analysis Parser Combinator
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ir_pseudo_assembly/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    IR & Pseudo Assembly
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_9" >
        
          
          <label class="md-nav__link" for="__nav_9" id="__nav_9_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W8
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            W8
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../semantic_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Semantic Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dynamic_semantics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Dynamic Semantics
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_10" >
        
          
          <label class="md-nav__link" for="__nav_10" id="__nav_10_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W9
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_10_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_10">
            <span class="md-nav__icon md-icon"></span>
            W9
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../static_semantics/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Static Semantics
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../static_semantics_2/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Static Semantics for Lambda Calculus
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_11" >
        
          
          <label class="md-nav__link" for="__nav_11" id="__nav_11_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W10
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_11_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_11">
            <span class="md-nav__icon md-icon"></span>
            W10
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../name_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Name Analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_12" >
        
          
          <label class="md-nav__link" for="__nav_12" id="__nav_12_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W11
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_12_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_12">
            <span class="md-nav__icon md-icon"></span>
            W11
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sign_analysis_lattice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Lattices & Sign Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../liveness_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Liveness Analysis
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Generation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_13" >
        
          
          <label class="md-nav__link" for="__nav_13" id="__nav_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    W12
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_13_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_13">
            <span class="md-nav__icon md-icon"></span>
            W12
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../code_generation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code Generation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advanced_static_analysis/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Information Flow Analysis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_14" checked>
        
          
          <label class="md-nav__link" for="__nav_14" id="__nav_14_label" tabindex="">
            
  
  <span class="md-ellipsis">
    W13
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_14_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_14">
            <span class="md-nav__icon md-icon"></span>
            W13
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Memory Management
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Memory Management
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Outcomes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudo-assembly-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudo Assembly (Extended)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pseudo Assembly (Extended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operational-semantics-for-extended-pa" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Semantics for Extended PA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-content-call-stack-design-in-target-platform" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional Content) Call Stack Design in Target Platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#another-example-with-heap-memory-access" class="md-nav__link">
    <span class="md-ellipsis">
      Another example with heap memory access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Another example with heap memory access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simp-extended-with-function-and-array" class="md-nav__link">
    <span class="md-ellipsis">
      SIMP (extended with function and array)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operational-semantic-of-extended-simp" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Semantic of extended SIMP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operational Semantic of extended SIMP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-program" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP Program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Big Step Operational Semantics for extended SIMP Program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simp-to-pa-conversion-extended" class="md-nav__link">
    <span class="md-ellipsis">
      SIMP to PA conversion (Extended)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extend-simp-type-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Extend SIMP Type checking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extend SIMP Type checking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-expression-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Expression (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-statement-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Statement (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-declaration-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Declaration (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_2" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_3" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-time-errors-caused-by-illegal-memory-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Run-time errors caused by illegal memory operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run-time errors caused by illegal memory operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#double-freeing" class="md-nav__link">
    <span class="md-ellipsis">
      Double-freeing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#missing-free" class="md-nav__link">
    <span class="md-ellipsis">
      Missing free
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-out-of-bound" class="md-nav__link">
    <span class="md-ellipsis">
      Array out of bound
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking-expression-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking Expression using Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type Checking Expression using Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_4" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-statement-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking Statement using Linear Type System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-declaration-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Declaration using Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type Checking SIMP Declaration using Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rejecting-simp3-via-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Rejecting SIMP3 via linear type system
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rejecting-simp4-via-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Rejecting SIMP4 via linear type system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-linear-type-system-practical" class="md-nav__link">
    <span class="md-ellipsis">
      Make linear type system practical
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#learning-outcomes" class="md-nav__link">
    <span class="md-ellipsis">
      Learning Outcomes
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pseudo-assembly-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Pseudo Assembly (Extended)
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Pseudo Assembly (Extended)">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#operational-semantics-for-extended-pa" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Semantics for Extended PA
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#optional-content-call-stack-design-in-target-platform" class="md-nav__link">
    <span class="md-ellipsis">
      (Optional Content) Call Stack Design in Target Platform
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#another-example-with-heap-memory-access" class="md-nav__link">
    <span class="md-ellipsis">
      Another example with heap memory access
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Another example with heap memory access">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simp-extended-with-function-and-array" class="md-nav__link">
    <span class="md-ellipsis">
      SIMP (extended with function and array)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#operational-semantic-of-extended-simp" class="md-nav__link">
    <span class="md-ellipsis">
      Operational Semantic of extended SIMP
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Operational Semantic of extended SIMP">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-expression" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP expression
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-statement" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP statement
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#big-step-operational-semantics-for-extended-simp-program" class="md-nav__link">
    <span class="md-ellipsis">
      Big Step Operational Semantics for extended SIMP Program
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Big Step Operational Semantics for extended SIMP Program">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_1" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#simp-to-pa-conversion-extended" class="md-nav__link">
    <span class="md-ellipsis">
      SIMP to PA conversion (Extended)
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#extend-simp-type-checking" class="md-nav__link">
    <span class="md-ellipsis">
      Extend SIMP Type checking
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Extend SIMP Type checking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-expression-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Expression (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-statement-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Statement (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-declaration-extended" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Declaration (Extended)
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#example" class="md-nav__link">
    <span class="md-ellipsis">
      Example
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_2" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_3" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#run-time-errors-caused-by-illegal-memory-operations" class="md-nav__link">
    <span class="md-ellipsis">
      Run-time errors caused by illegal memory operations
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Run-time errors caused by illegal memory operations">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#double-freeing" class="md-nav__link">
    <span class="md-ellipsis">
      Double-freeing
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#missing-free" class="md-nav__link">
    <span class="md-ellipsis">
      Missing free
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#array-out-of-bound" class="md-nav__link">
    <span class="md-ellipsis">
      Array out of bound
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#type-checking-expression-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking Expression using Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type Checking Expression using Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#cohort-exercise_4" class="md-nav__link">
    <span class="md-ellipsis">
      Cohort Exercise
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-statement-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking Statement using Linear Type System
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#type-checking-simp-declaration-using-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Type Checking SIMP Declaration using Linear Type System
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Type Checking SIMP Declaration using Linear Type System">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#rejecting-simp3-via-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Rejecting SIMP3 via linear type system
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#rejecting-simp4-via-linear-type-system" class="md-nav__link">
    <span class="md-ellipsis">
      Rejecting SIMP4 via linear type system
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#make-linear-type-system-practical" class="md-nav__link">
    <span class="md-ellipsis">
      Make linear type system practical
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="50054-memory-management">50.054 - Memory Management<a class="headerlink" href="#50054-memory-management" title="Permanent link">&para;</a></h1>
<h2 id="learning-outcomes">Learning Outcomes<a class="headerlink" href="#learning-outcomes" title="Permanent link">&para;</a></h2>
<ol>
<li>Extend PA to support function call and array operations</li>
<li>Extend the dynamic semantics to model the run-time memory operations</li>
<li>Define activation records</li>
<li>Extend SIMP to support function call and array operations</li>
<li>Describe the challenges of memory management</li>
<li>Apply linear type system to ensure memory saftey in SIMP.</li>
</ol>
<h2 id="pseudo-assembly-extended">Pseudo Assembly (Extended)<a class="headerlink" href="#pseudo-assembly-extended" title="Permanent link">&para;</a></h2>
<p>So far, we have been dealing with a toy language without function call nor complex data structure. We consider extending the <a href="../ir_pseudo_assembly/#pseudo-assembly">Pseudo Assembly language syntax</a> as follows</p>
<div class="arithmatex">\[
\begin{array}{rccl}
(\tt Instruction)   &amp; i   &amp; ::= &amp; ... \mid begin\ f\ d \mid call\ f\ s \mid d \leftarrow alloc\ s \mid free\ s  \\ 
&amp; &amp;  &amp; \mid  d \leftarrow ref\ s \mid deref\ s\ s\\ 
\end{array}
\]</div>
<p>Besides the existing instructions, we include</p>
<ul>
<li><span class="arithmatex">\(begin\ f\ d\)</span> - denotes the start of a function name <span class="arithmatex">\(f\)</span> (<span class="arithmatex">\(f\)</span> is a variable) and the formal argument (operand) <span class="arithmatex">\(d\)</span>. </li>
<li><span class="arithmatex">\(call\ f\ s\)</span> - denotes a function invocation of <span class="arithmatex">\(f\)</span> with actual argument <span class="arithmatex">\(s\)</span>.</li>
<li><span class="arithmatex">\(d \leftarrow alloc\ s\)</span> - denotes the memory allocation. It allocates <span class="arithmatex">\(s\)</span> bytes of unoccupied memory and assigns the reference address to <span class="arithmatex">\(d\)</span>. </li>
<li><span class="arithmatex">\(free\ s\)</span> - deallocates the allocated memory at address stored in <span class="arithmatex">\(s\)</span>. </li>
<li><span class="arithmatex">\(d \leftarrow ref\ s\)</span> - references the value at the memory address stored in <span class="arithmatex">\(s\)</span> and copies it to <span class="arithmatex">\(d\)</span>. </li>
<li><span class="arithmatex">\(deref\ s_1\ s_2\)</span> - dereferences the memory location stored in <span class="arithmatex">\(s_1\)</span> and updates with the value of <span class="arithmatex">\(s_2\)</span>. </li>
</ul>
<h3 id="operational-semantics-for-extended-pa">Operational Semantics for Extended PA<a class="headerlink" href="#operational-semantics-for-extended-pa" title="Permanent link">&para;</a></h3>
<p>We extend the operational semantics of Pseudo Assembly defined in <a href="../dynamic_semantics/#operational-semantics-of-pseudo-assembly">here</a>. Instead of mixing the temp variable-to-constant mappings and register-to-constant mappings in <span class="arithmatex">\(L\)</span>, we move the register-to-constant mappings in <span class="arithmatex">\(R\)</span>. </p>
<div class="arithmatex">\[
\begin{array}{rccl}
(\tt PA\ Stack\ Frame) &amp; L &amp; \subseteq &amp; (t \times c) \\ 
(\tt PA\ Register\ Environment) &amp; R &amp; \subseteq &amp; (r \times c) \\ 
(\tt PA\ Heap\ Registry) &amp; G &amp; \subseteq &amp; (loc \times loc ) \\ 
(\tt PA\ Heap\ Memory) &amp; H &amp; \subseteq &amp; (loc \times c) \\ 
(\tt Heap\ Address) &amp; loc &amp; ::= &amp; loc(1) \mid ... \mid loc(n) \\ 
(\tt PA\ Memory\ Environment) &amp; M &amp; ::= &amp; (\overline{L}, \overline{l}, H, G, R) 
\end{array}
\]</div>
<ul>
<li><span class="arithmatex">\(G\)</span> - denotes a set of address tuples. The first address in the tuple denotes the starting address of the allocated memory in the heap (inclusive) and the second one denotes the ending address (exclusive).</li>
<li><span class="arithmatex">\(H\)</span> - denotes the mapping from addresses to constants. <span class="arithmatex">\(G\)</span> and <span class="arithmatex">\(H\)</span> together model the run-time heap memory</li>
<li><span class="arithmatex">\(M\)</span> - a tuple of 5 items. A stack of stack frames <span class="arithmatex">\(\overline{L}\)</span>, a stack of function invocation labels <span class="arithmatex">\(\overline{l}\)</span> (a sequence of labels marking the function calling instructions), the heap and the register environment. <span class="arithmatex">\(\overline{L}\)</span> and <span class="arithmatex">\(\overline{l}\)</span> should have the same size. Given an index <span class="arithmatex">\(i\)</span>, the <span class="arithmatex">\(i\)</span>-th elements in <span class="arithmatex">\(\overline{L}\)</span> and <span class="arithmatex">\(\overline{l}\)</span> form the <em>activation record</em>.</li>
</ul>
<p>The small step operational semantic rules in shape <span class="arithmatex">\(P \vdash (L, li) \longrightarrow (L, li)\)</span> introduced in our earlier <a href="../dynamic_semantics/#operational-semantics-of-pseudo-assembly">class</a> are modified to have shape of <span class="arithmatex">\(P \vdash (M, li) \longrightarrow (M, li)\)</span>.  </p>
<p>We highlight the important rules</p>
<div class="arithmatex">\[
\begin{array}{cc}
{\tt (pAlloc)} &amp;  \begin{array}{c}
        M = (L:\overline{L}, \overline{l}, H, G, R) \ \ \ \ 
        findfree(G,L(s)) = loc \\ 
        H' = H\cup[(loc + i, 0) \mid i \in \{0, L(s)-1\}] \ \ \ G' = G \cup[(loc, loc+L(s))] \\ 
        M' = (L\oplus(d,loc):\overline{L}, \overline{l}, H', G',  R)
        \\ \hline
        P \vdash (M, l: d \leftarrow alloc\ s) \longrightarrow (M', P(l+1))  
        \end{array} \\ \\ 
{\tt (pFree)} &amp; \begin{array}{c}
        M = (L:\overline{L}, \overline{l}, H, G, R) \ \ \ \ loc = L(s) \\ 
        G'\cup[(loc,loc')] = G \ \ \ \ H' = H - \{ loc, ..., loc' \} \ \ \ \
        M' = (L:\overline{L}, \overline{l}, H', G', R) \\ \hline
        P \vdash (M, l: free\ s) \longrightarrow (M', P(l+1))
        \end{array} \\ \\ 
{\tt (pRef)} &amp; \begin{array}{c}
        M = (L:\overline{L}, \overline{l}, H, G, R) \ \ \ \ loc = L(s) \\ 
        \exists (loc_1, loc_2) \in G. loc_1 \leq loc &lt; loc_2 \\ 
        v = H(loc) \ \ \ M' = (L\oplus(d,v):\overline{L}, \overline{l}, H, G, R)
        \\ \hline
        P \vdash ( M, l: d \leftarrow ref\ s) \longrightarrow (M', P(l+1))
        \end{array} \\ \\ 
{\tt (pDeref)} &amp; \begin{array}{c} 
        M = (L:\overline{L}, \overline{l}, H,G, R) \ \ \ \ loc = L(s_1) \\
        \exists (loc_1, loc_2) \in G. loc_1 \leq loc &lt; loc_2 \\ 
        H' = H \oplus (loc, L(s_2)) \ \ \ M' = (L:\overline{L}, \overline{l}, H', G, R)\\ \hline
        P \vdash (M ,l: deref\ s_1\ s_2) \longrightarrow (M', P(l+1))
        \end{array}
\end{array} 
\]</div>
<ul>
<li>The rule <span class="arithmatex">\((\tt pAlloc)\)</span> defines the memory allocation routine. Given the asking size, <span class="arithmatex">\(L(s)\)</span>, we make use of the run-time built-in function <span class="arithmatex">\(findfree()\)</span> to locate the starting address of the free memory region. We save the starting address in <span class="arithmatex">\(d\)</span>, and "zero-out" the allocated region addresses ranging from <span class="arithmatex">\(loc\)</span> to <span class="arithmatex">\(loc+L(s)\)</span>. </li>
<li>The rule <span class="arithmatex">\((\tt pFree)\)</span> defines the memory deallocation routine. Given the starting address of the memory to be freed <span class="arithmatex">\(loc\)</span>, we remove the pair <span class="arithmatex">\((loc, loc')\)</span> from <span class="arithmatex">\(G\)</span> and the keys in the range <span class="arithmatex">\((loc, loc')\)</span>  from <span class="arithmatex">\(H\)</span>.</li>
<li>The rule <span class="arithmatex">\((\tt pRef)\)</span> defines the memory reference operation. Given the referenced address <span class="arithmatex">\(loc\)</span>, we ensure the address is in <span class="arithmatex">\(G\)</span> (which implies it is in <span class="arithmatex">\(H\)</span>). We store the value <span class="arithmatex">\(H(loc)\)</span>  into the stack frame and move onto the next instruction. </li>
<li>The rule <span class="arithmatex">\((\tt pDeref)\)</span> defines the memory deference operation. Given the dereferenced address <span class="arithmatex">\(loc\)</span>, we ensure the address is in <span class="arithmatex">\(G\)</span> (which implies it is in <span class="arithmatex">\(H\)</span>). We update the value in <span class="arithmatex">\(H\)</span> at location <span class="arithmatex">\(loc\)</span> to <span class="arithmatex">\(L(s_2)\)</span>.</li>
</ul>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (pCall)} &amp;  \begin{array}{c}
        l': begin\ f\ d' \in P \ \ \ M = (L:\overline{L}, \overline{l}, H, G, R) \\ 
        M' = (\{(d', L(s))\}:L:\overline{L}, l:\overline{l}, H, G, R)
        \\ \hline
        P \vdash (M, l: d \leftarrow call\ f\ s) \longrightarrow (M', P(l'+1))  
        \end{array} \\ \\ 
{\tt (pBegin)} &amp; \begin{array}{c}
        (l':ret) \in P \ \ \ \forall (l'':ret) \in P: l''&gt;= l \implies l'' &gt;= l'
        \\ \hline
        P \vdash (M, l:begin\ f\ d) \longrightarrow (M, P(l'+1)) 
        \end{array} \\ \\ 
{\tt (pRet1)} &amp;  \begin{array}{c}
        M = (L':L:\overline{L}, l':\overline{l}, H, G, R)\ \ \ 
        l': d \leftarrow call\ f\ s \in P \\  
        R' = R - {r_{ret}} \ \ \ 
        M' = (L\oplus(d,R(r_{ret})):\overline{L}, \overline{l}, H, G, R')
        \\ \hline
        P \vdash (M, l:ret) \longrightarrow (M', P(l'+1))  
        \end{array} \\ \\ 
{\tt (pRet2)} &amp;  \begin{array}{c}
        M = (\overline{L}, [], H, G, R)\ \ \ 
        \\ \hline
        P \vdash (M, l:ret) \longrightarrow exit(R(r_{ret}))
        \end{array} 
\end{array}
\]</div>
<ul>
<li>The rule <span class="arithmatex">\((\tt pCall)\)</span> handles the function call instruction. In this case, we search for the begin statement of the callee. We push the new stack frame into the stack with the binding of the input argument. We push the caller's label into the labels stack. The executation context is shifted to the function body instruction. </li>
<li>The rule <span class="arithmatex">\((\tt pBegin)\)</span> processes the begin instruction. Since it is the defining the function, we skip the function body and move to the instruction that follows the return instruction. </li>
<li>The rule <span class="arithmatex">\((\tt pRet1)\)</span> manages the termination of a function call. We pop the stack frame and the top label <span class="arithmatex">\(l'\)</span> from the stack. We search for the caller instruction by the label <span class="arithmatex">\(l'\)</span>. We update the caller's stack frame with the returned value of the function call. </li>
<li>The rule <span class="arithmatex">\({\tt pRet2}\)</span> defines the termination of the entire program.</li>
</ul>
<p>We omit the rest of rules as we need to change the <span class="arithmatex">\(L\)</span> to <span class="arithmatex">\(M = (L:\overline{L}, \overline{l}, H, G, R)\)</span>.</p>
<p>For example given a PA program </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span>
<span class="normal"><a href="#__codelineno-0-6">6</a></span>
<span class="normal"><a href="#__codelineno-0-7">7</a></span>
<span class="normal"><a href="#__codelineno-0-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="c1">// PA1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">begin</span><span class="w"> </span><span class="n">plus1</span><span class="w"> </span><span class="n">x</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">y</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">z</span><span class="w">    </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">plus1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span>
</span></code></pre></div></td></tr></table></div>
<p>We have the following derivation</p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span>
<span class="normal"><a href="#__codelineno-1-2">2</a></span>
<span class="normal"><a href="#__codelineno-1-3">3</a></span>
<span class="normal"><a href="#__codelineno-1-4">4</a></span>
<span class="normal"><a href="#__codelineno-1-5">5</a></span>
<span class="normal"><a href="#__codelineno-1-6">6</a></span>
<span class="normal"><a href="#__codelineno-1-7">7</a></span>
<span class="normal"><a href="#__codelineno-1-8">8</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[]]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">),</span><span class="w"> </span><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">begin</span><span class="w"> </span><span class="n">plus1</span><span class="w"> </span><span class="n">x</span><span class="w">  </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pBegin</span><span class="p">)</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[]]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">),</span><span class="w"> </span><span class="mi">5</span><span class="p">:</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">plus1</span><span class="w"> </span><span class="mi">0</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pCall</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span><span class="o">]</span><span class="p">,</span><span class="o">[]]</span><span class="p">,</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">),</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pOp</span><span class="p">)</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span><span class="p">,</span><span class="o">[]]</span><span class="p">,</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">),</span><span class="w"> </span><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pTempVar</span><span class="p">)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">),(</span><span class="n">y</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span><span class="p">,</span><span class="o">[]]</span><span class="p">,</span><span class="o">[</span><span class="mi">5</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="p">(</span><span class="n">rret</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span><span class="w">  </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pRet1</span><span class="p">)</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]]</span><span class="p">,</span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">),</span><span class="w"> </span><span class="mi">6</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">z</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pTempVar</span><span class="p">)</span><span class="w"> </span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="p">(</span><span class="o">[[</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]]</span><span class="p">,</span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[]</span><span class="p">,</span><span class="w"> </span><span class="o">[</span><span class="p">(</span><span class="n">rret</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">]</span><span class="p">)</span><span class="w"> </span><span class="mi">7</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">---&gt;</span><span class="w"> </span><span class="err">#</span><span class="w"> </span><span class="p">(</span><span class="n">pRet2</span><span class="p">)</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8"></a><span class="n">P</span><span class="w"> </span><span class="o">|-</span><span class="w"> </span><span class="n">exit</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="optional-content-call-stack-design-in-target-platform">(Optional Content) Call Stack Design in Target Platform<a class="headerlink" href="#optional-content-call-stack-design-in-target-platform" title="Permanent link">&para;</a></h3>
<p>The call stack in the target platform is often implemented as a sequence of memory locations. The bottom of the stack has the lowest address of the entire stack and the top of the stack has the highest address (at a particular point in time.)</p>
<table>
<thead>
<tr>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>frame for <code>main()</code></td>
</tr>
<tr>
<td>frame for <code>plus1(x)</code></td>
</tr>
<tr>
<td>...</td>
</tr>
</tbody>
</table>
<p>If we zoom into the frame for <code>plus1(x)</code> </p>
<table>
<thead>
<tr>
<th>address</th>
<th>content</th>
</tr>
</thead>
<tbody>
<tr>
<td>fp-4</td>
<td>param x</td>
</tr>
<tr>
<td>fp</td>
<td>caller label/return address</td>
</tr>
<tr>
<td>fp+4</td>
<td>tempvar y</td>
</tr>
</tbody>
</table>
<p>the frame pointer <code>fp</code> marks the memory address where ther caller's label/address is stored. If we subtract the parameter size offset from <code>fp</code>, say <code>fp-4</code>, we can access the paramter <code>x</code> and if we add the variable size offset to <code>fp</code>, we access the temp variables, in this case we can statically determine the size of the call frame, as 3 * 4 bytes. As a convention, the <code>begin</code> instruction in the target code is associated with the frame size required by this function.  When we make a function call in the target code, we have to push the parameter into the call stack one by one. </p>
<p>i.e. the instruction <code>5</code> in the above example <code>PA1</code> should be broken into </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span>
<span class="normal"><a href="#__codelineno-2-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="mf">5.1</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="mf">5.2</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">plus1</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3"></a><span class="mf">5.3</span><span class="w"> </span><span class="n">popframe</span><span class="w"> </span><span class="mi">12</span>
</span></code></pre></div></td></tr></table></div>
<ul>
<li>At 5.1, we push the actual argument as the parameter <code>x</code>. </li>
<li>At 5.2, we call the function and shift the program counter to the starting label/address of the function body.</li>
<li>When the function terminates, we jump back to 5.2, then at 5.3, we pop the stack frame based on its size.</li>
</ul>
<p>In case a function has multiple parameters, the parameters are pushed from 
right to left. </p>
<p>For example, if we have a <code>min(x,y)</code> function which has no local variable and we call <code>min(-10,9)</code>, we generate the following target code</p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span>
<span class="normal"><a href="#__codelineno-3-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="mi">1</span><span class="p">:</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="mi">9</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="mi">2</span><span class="p">:</span><span class="w"> </span><span class="n">param</span><span class="w"> </span><span class="o">-</span><span class="mi">10</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="mi">3</span><span class="p">:</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">min</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4"></a><span class="mi">4</span><span class="p">:</span><span class="w"> </span><span class="n">popframe</span><span class="w"> </span><span class="mi">12</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="another-example-with-heap-memory-access">Another example with heap memory access<a class="headerlink" href="#another-example-with-heap-memory-access" title="Permanent link">&para;</a></h3>
<p>The following PA program is an example of using the memory from the heap. </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-4-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-4-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-4-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-4-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-4-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-4-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-4-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-4-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-4-10">10</a></span>
<span class="normal"><a href="#__codelineno-4-11">11</a></span>
<span class="normal"><a href="#__codelineno-4-12">12</a></span>
<span class="normal"><a href="#__codelineno-4-13">13</a></span>
<span class="normal"><a href="#__codelineno-4-14">14</a></span>
<span class="normal"><a href="#__codelineno-4-15">15</a></span>
<span class="normal"><a href="#__codelineno-4-16">16</a></span>
<span class="normal"><a href="#__codelineno-4-17">17</a></span>
<span class="normal"><a href="#__codelineno-4-18">18</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="c1">// PA2 </span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2"></a><span class="mi">1</span><span class="p">:</span><span class="w">  </span><span class="n">begin</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="n">x</span><span class="w"> </span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3"></a><span class="mi">2</span><span class="p">:</span><span class="w">  </span><span class="n">s</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4"></a><span class="mi">3</span><span class="p">:</span><span class="w">  </span><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">alloc</span><span class="w"> </span><span class="n">s</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5"></a><span class="mi">4</span><span class="p">:</span><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="mi">0</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6"></a><span class="mi">5</span><span class="p">:</span><span class="w">  </span><span class="n">t</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7"></a><span class="mi">6</span><span class="p">:</span><span class="w">  </span><span class="n">ifn</span><span class="w"> </span><span class="n">t</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">11</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8"></a><span class="mi">7</span><span class="p">:</span><span class="w">  </span><span class="n">ai</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">i</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9"></a><span class="mi">8</span><span class="p">:</span><span class="w">  </span><span class="n">deref</span><span class="w"> </span><span class="n">ai</span><span class="w"> </span><span class="n">i</span><span class="w"> </span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10"></a><span class="mi">9</span><span class="p">:</span><span class="w">  </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11"></a><span class="mi">10</span><span class="p">:</span><span class="w"> </span><span class="k">goto</span><span class="w"> </span><span class="mi">5</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12"></a><span class="mi">11</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">a</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13"></a><span class="mi">12</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14"></a><span class="mi">13</span><span class="p">:</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">call</span><span class="w"> </span><span class="n">range</span><span class="w"> </span><span class="mi">3</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15"></a><span class="mi">14</span><span class="p">:</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">ref</span><span class="w"> </span><span class="n">r</span><span class="w"> </span><span class="mi">2</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16"></a><span class="mi">15</span><span class="p">:</span><span class="w"> </span><span class="n">free</span><span class="w"> </span><span class="n">r</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17"></a><span class="mi">16</span><span class="p">:</span><span class="w"> </span><span class="n">rret</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">y</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18"></a><span class="mi">17</span><span class="p">:</span><span class="w"> </span><span class="n">ret</span>
</span></code></pre></div></td></tr></table></div>
<p>Instructions 1-12 define the <code>range(x)</code> function, which initializes an array with the given size <code>x</code> and the values are from <code>0</code> to <code>x</code>. Lines 13-14 invoke the function and access the 3<sup>rd</sup> element. Line 15 frees the memory.</p>
<h4 id="cohort-exercise">Cohort Exercise<a class="headerlink" href="#cohort-exercise" title="Permanent link">&para;</a></h4>
<p>As an exercise, can you work out the derivation of "running" the above program <code>PA2</code> using the operational semantics?</p>
<h2 id="simp-extended-with-function-and-array">SIMP (extended with function and array)<a class="headerlink" href="#simp-extended-with-function-and-array" title="Permanent link">&para;</a></h2>
<p>We consider syntax of the <a href="../ir_pseudo_assembly/#the-simp-language">SIMP language</a> extended with function and array.</p>
<div class="arithmatex">\[
\begin{array}{rccl}
(\tt Statement) &amp; S &amp; ::= &amp; ... \mid X[E] = E  \mid free\ X \\ 
(\tt Expression) &amp; E &amp; ::= &amp; ... \mid f(E) \mid T[E] \mid X[E] \\
(\tt Function\ Declaration) &amp; D &amp; ::= &amp; func\ f\ (x:T)\ T\ \{\overline{S}\} \\ 
(\tt Constant) &amp; C &amp; ::= &amp; 0 \mid 1 \mid 2 \mid ... \mid true \mid false \\ 
(\tt Type) &amp; T &amp; ::= &amp; ... \mid [T] \mid T \rightarrow T \mid unit \\ 
(\tt Value) &amp; V &amp; ::= &amp; C \mid D \mid (loc, loc) \mid unit \\
(\tt Program) &amp; P &amp; ::= &amp; \overline{D};\overline{S}
\end{array}
\]</div>
<p>New statement syntax includes:</p>
<ul>
<li><span class="arithmatex">\(X[E] = E\)</span> - denotes an array element assignment statement</li>
<li><span class="arithmatex">\(free\ X\)</span> - dellocate the array referenced by variable <span class="arithmatex">\(X\)</span>. </li>
</ul>
<p>New expression syntax includes</p>
<ul>
<li><span class="arithmatex">\(f(E)\)</span> - function application, where <span class="arithmatex">\(f\)</span> is a function name (a special variable)</li>
<li><span class="arithmatex">\(T[E]\)</span> - array initialization, where <span class="arithmatex">\(T\)</span> is the element type of the array and <span class="arithmatex">\(E\)</span> denotes the size of the array.</li>
<li><span class="arithmatex">\(X[E]\)</span> - array element dereference, where <span class="arithmatex">\(X\)</span> is an array and <span class="arithmatex">\(E\)</span> is the element index. </li>
</ul>
<p>Function declaration syntax includes</p>
<ul>
<li><span class="arithmatex">\(func\ f\ (x:T)\ T\ \{\overline{S}\}\)</span> - <span class="arithmatex">\(f\)</span> is the function name; <span class="arithmatex">\((x:T)\)</span> is the formal parameter and its type. The second <span class="arithmatex">\(T\)</span> is the return type. <span class="arithmatex">\(\overline{S}\)</span> is the body.</li>
</ul>
<p>New type sytanx includes</p>
<ul>
<li><span class="arithmatex">\([T]\)</span> - array type</li>
<li><span class="arithmatex">\(T \rightarrow T\)</span> - function type</li>
<li><span class="arithmatex">\(unit\)</span> - the type has only one value <span class="arithmatex">\(unit\)</span> (its role is similar to the <span class="arithmatex">\(void\)</span> type in Java and C)</li>
</ul>
<p>Value syntax includes</p>
<ul>
<li><span class="arithmatex">\(C\)</span> - constant</li>
<li><span class="arithmatex">\(D\)</span> - declaration</li>
<li><span class="arithmatex">\((loc, loc)\)</span> - memory segment, the first item is the starting address (inclusive) and the second item is the ending address (exclusive)</li>
<li><span class="arithmatex">\(unit\)</span> - the only value for the <span class="arithmatex">\(unit\)</span> type.</li>
</ul>
<p>A SIMP program is a sequence of function declarations followed by a sequence of statements. </p>
<p>For example, the following SIMP program is equivalent to Pseudo Assembly program <code>PA1</code> introduced earlier.</p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span>
<span class="normal"><a href="#__codelineno-5-6">6</a></span>
<span class="normal"><a href="#__codelineno-5-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="c1">// SIMP1 </span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="n">func</span><span class="w"> </span><span class="nf">plus1</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="p">}</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6"></a><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7"></a><span class="k">return</span><span class="w"> </span><span class="n">z</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>The following SIMP program is equivalent to Pseudo Assembly program <code>PA2</code></p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-6-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-6-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-6-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-6-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-6-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-6-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-6-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-6-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-6-10">10</a></span>
<span class="normal"><a href="#__codelineno-6-11">11</a></span>
<span class="normal"><a href="#__codelineno-6-12">12</a></span>
<span class="normal"><a href="#__codelineno-6-13">13</a></span>
<span class="normal"><a href="#__codelineno-6-14">14</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="c1">// SIMP2 array enumeration</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2"></a><span class="n">func</span><span class="w"> </span><span class="nf">range</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="o">[</span><span class="kt">int</span><span class="o">]</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3"></a><span class="w">    </span><span class="n">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4"></a><span class="w">    </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6"></a><span class="w">        </span><span class="n">a</span><span class="o">[</span><span class="n">i</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="p">;</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7"></a><span class="w">        </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">a</span><span class="p">;</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10"></a><span class="p">}</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11"></a><span class="n">r</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">range</span><span class="p">(</span><span class="mi">3</span><span class="p">);</span><span class="w"> </span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">r</span><span class="o">[</span><span class="mi">2</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13"></a><span class="n">free</span><span class="w"> </span><span class="n">r</span><span class="p">;</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14"></a><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h2 id="operational-semantic-of-extended-simp">Operational Semantic of extended SIMP<a class="headerlink" href="#operational-semantic-of-extended-simp" title="Permanent link">&para;</a></h2>
<p>For brevity, we consider the big step operational semantics of extended SIMP by extending the <a href="../dynamic_semantics/#big-step-operational-semantics">rules</a>.</p>
<div class="arithmatex">\[
\begin{array}{rccl}
(\tt SIMP\ Var\ Environment) &amp; \Delta &amp; \subseteq &amp; (X \times V) \\ 
(\tt SIMP\ Obj\ Environment) &amp; \rho &amp; \subseteq &amp; (loc \times V)
\end{array}
\]</div>
<p>First and foremost, in the extended SIMP, values include function declarations, memory tuples and unit, besides constants. Hence the <span class="arithmatex">\(\Delta\)</span> environment maps variables to values. 
Besides the variable environment <span class="arithmatex">\(\Delta\)</span>, we define the object (heap) environment <span class="arithmatex">\(\rho\)</span> as a mapping from memory location to values.</p>
<h3 id="big-step-operational-semantics-for-extended-simp-expression">Big Step Operational Semantics for extended SIMP expression<a class="headerlink" href="#big-step-operational-semantics-for-extended-simp-expression" title="Permanent link">&para;</a></h3>
<p>The rules of shape <span class="arithmatex">\(\Delta \vdash E \Downarrow C\)</span> have to be adapted to the shape of <span class="arithmatex">\(\overline{\Delta} \vdash (\rho, E) \Downarrow (\rho', V)\)</span>, where <span class="arithmatex">\(\overline{\Delta}\)</span> is the stack of variable environments.</p>
<p>For example, the <span class="arithmatex">\((\tt bVar)\)</span> rule is updated as follows</p>
<div class="arithmatex">\[
{\tt (bVar)} ~~~~ \Delta:\overline{\Delta} \vdash (\rho, X) \Downarrow (\rho,\Delta(X))
\]</div>
<p>The rest of the rules can be easily adapted to the new scheme. Now we consider cases for the new syntax.</p>
<div class="arithmatex">\[
{\tt (bApp)} ~~~~ \begin{array}{c}
        \overline{\Delta} \vdash (\rho, E_2) \Downarrow (\rho_2,V_2) \\ 
        (f, func\ f\ (x:T_1)T_2 \{\overline{S}\}) \in \overline{\Delta} \\ 
        \Delta =  \{(x,V_2)\} \ \ \ (\Delta:\overline{\Delta}, \rho_2, \overline{S}) \Downarrow (\Delta':\overline{\Delta'}, \rho_3, return\ y) \ \ \ (y, V)\in \Delta'
        \\ \hline
        \overline{\Delta} \vdash (\rho, f(E_2)) \Downarrow (\rho_3, V)
        \end{array}
\]</div>
<p>In case of a function application, we first evaluate the function argument into a value. We search for the function definition from the variable environment <span class="arithmatex">\(\overline{\Delta}\)</span> (in the order from the top frame to the bottom frame). A new variable environment (frame) <span class="arithmatex">\(\Delta\)</span> is created to store the binding between the function's formal argument and the actual argument. We then call the statement evaluation rules (to be discussed shortly) to run the body the of the function.  Finally, we retrieve the returned value from the call.</p>
<div class="arithmatex">\[
{\tt (bArrInst)} ~~~~ \begin{array}{c}
        \overline{\Delta} \vdash (\rho, E_2) \Downarrow (\rho_1,V_2) \\ 
        \forall x \in [m, m+V_2). loc(x) \not\in dom(\rho) \\ 
        V = default(T) \ \ \
        \rho' = \rho \cup \{ (loc(x), V) \mid x \in [m, m+V_2) \} 
        \\ \hline
        \overline{\Delta} \vdash (\rho, T[E_2]) \Downarrow (\rho', (loc(m), loc(m+V_2)))
        \end{array}
\]</div>
<p>In case of an array instantiation, we first evaluate the size argument into a value (must be an integer constant).
We find a sequence of unsused memory locations <span class="arithmatex">\(loc(m)\)</span> to <span class="arithmatex">\(loc(m+V_2)\)</span> and initialize the value to the default value. </p>
<div class="arithmatex">\[
{\tt (bArrRef)} ~~~~ \begin{array}{c}
        (X, (loc(m_1), loc(m_2))) \in \Delta \\
        \Delta:\overline{\Delta} \vdash (\rho, E_2) \Downarrow (\rho_2, V_2) \ \ \ \
        m_1 + V_2 &lt; m_2
        \\ \hline
        \Delta:\overline{\Delta} \vdash (\rho, X[E_2]) \Downarrow (\rho_2, \rho_2(loc(m_1 + V_2))
        \end{array}
\]</div>
<p>In case of an array reference, we lookup the memory location boundaries of <span class="arithmatex">\(X\)</span>, then
we evaluate <span class="arithmatex">\(E_2\)</span> into a constant (integer) <span class="arithmatex">\(V_2\)</span>. If the index is within the boundary, we lookup 
the value associated with the address. </p>
<h3 id="big-step-operational-semantics-for-extended-simp-statement">Big Step Operational Semantics for extended SIMP statement<a class="headerlink" href="#big-step-operational-semantics-for-extended-simp-statement" title="Permanent link">&para;</a></h3>
<p>Similarly, to support the change of SIMP statement,
 we adapt the big step oeprational semantics rule of shape <span class="arithmatex">\((\Delta, S) \Downarrow \Delta\)</span> to shape <span class="arithmatex">\((\overline{\Delta}, \rho, S) \Downarrow (\overline{\Delta'}, \rho', S')\)</span></p>
<p>For example the assignment statement rule is updated as follows</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (bAssign)} &amp; \begin{array}{c}
    \Delta:\overline{\Delta} \vdash (\rho,E) \Downarrow (\rho',V)
    \\ \hline
    (\Delta:\overline{\Delta}, \rho, X = E) \Downarrow (\Delta \oplus (X, V):\overline{\Delta}, \rho', nop)
    \end{array}
\end{array}
\]</div>
<p>We focus on the new rules and omit the rest of the rules</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (bArrDeref)} &amp; \begin{array}{c}
    \Delta:\overline{\Delta} \vdash (\rho,E_1) \Downarrow (\rho_1,V_1) \ \ \ \ 
    \Delta:\overline{\Delta} \vdash (\rho_1,E_2) \Downarrow (\rho_2,V_2) \\ 
    (X, (loc(m_1), loc(m_2))) \in \Delta \ \ \ m_1 + V_1 &lt; m_2 \\ 
    \rho_3 = \rho_2 \oplus (loc(m_1 + V_1), V_2)
    \\ \hline
    (\Delta:\overline{\Delta}, \rho, X[E_1] = E_2) \Downarrow (\Delta:\overline{\Delta}, \rho_3, nop)
    \end{array}
\end{array}
\]</div>
<p>In case of array deference, we first compute the index argument into an integer constant <span class="arithmatex">\(V_1\)</span>. We lookup the memory range <span class="arithmatex">\((loc(m_1), loc(m_2))\)</span> of <span class="arithmatex">\(X\)</span> and ensure that the <span class="arithmatex">\(m_1 + V_1\)</span> is within range. Evaluating <span class="arithmatex">\(E_2\)</span> yields the value to be assigned to the memory location <span class="arithmatex">\(loc(m_1 + V_1)\)</span>. Finally we return the updated object memory environment.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (bFree)} &amp; \begin{array}{c}
    (X, (loc(m_1), loc(m_2))) \in \Delta \ \ \ \ \ 
    \rho' \cup \{ (loc(x),V) \mid x \in [m_1, m_2)\} = \rho
    \\ \hline
    (\Delta:\overline{\Delta}, \rho, free\ X) \Downarrow (\Delta - ((X, (loc(m_1), loc(m_2)))):\overline{\Delta}, \rho', nop)
    \end{array}
\end{array}
\]</div>
<p>In case of free statement, we ensure that the argument is a variable that holding some reference to the object envrionment.  We remove the memory assignment from <span class="arithmatex">\(\rho\)</span> and remove <span class="arithmatex">\(X\)</span> from <span class="arithmatex">\(\Delta\)</span>. 
(In some system, <span class="arithmatex">\(X\)</span> is not removed from <span class="arithmatex">\(\Delta\)</span>, which causes the "double-freeing" error.)</p>
<h3 id="big-step-operational-semantics-for-extended-simp-program">Big Step Operational Semantics for extended SIMP Program<a class="headerlink" href="#big-step-operational-semantics-for-extended-simp-program" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (bProg)} &amp; \begin{array}{c}
        \Delta' = \Delta \oplus(f, func\ f\ (X:T_1)T_2\{\overline{S'}\}) \\
        (\Delta':\overline{\Delta}, \rho, \overline{D};\overline{S}) \Downarrow (\overline{\Delta''}, \rho', return\ X)
        \\ \hline
        (\Delta:\overline{\Delta}, \rho, func\ f\ (X:T_1)T_2\{\overline{S}\}; \overline{D};\overline{S}) \Downarrow (\overline{\Delta''}, \rho', return\ X)
        \end{array} \\ \\ 
{\tt (bSeq)} &amp; \begin{array}{c}
        (\overline{\Delta}, \rho, S) \Downarrow (\overline{\Delta}', \rho', nop) \\
        (\overline{\Delta'}, \rho', \overline{S}) \Downarrow (\overline{\Delta''}, \rho'', return\ X)
        \\ \hline
        \overline{\Delta}, \rho, S;\overline{S}) \Downarrow (\overline{\Delta''}, \rho'', return\ X)
        \end{array}
\end{array}
\]</div>
<p>The above two rules define the execution of a SIMP program and statement sequences. The rule <span class="arithmatex">\((\tt bProg)\)</span> records the variable <span class="arithmatex">\(f\)</span> to function definition binding in <span class="arithmatex">\(\Delta'\)</span> and we use <span class="arithmatex">\(\Delta':\overline{\Delta}\)</span> to evaluate the rest of the evaluation. 
The rule <span class="arithmatex">\((\tt bSeq)\)</span> evaluates the first statement until it becomes <span class="arithmatex">\(nop\)</span> and moves on the the rest of the statement.</p>
<p>For example, running the <code>SIMP1</code> program yields the following</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-7-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-7-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-7-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-7-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-7-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-7-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-7-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-7-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-7-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-7-10">10</a></span>
<span class="normal"><a href="#__codelineno-7-11">11</a></span>
<span class="normal"><a href="#__codelineno-7-12">12</a></span>
<span class="normal"><a href="#__codelineno-7-13">13</a></span>
<span class="normal"><a href="#__codelineno-7-14">14</a></span>
<span class="normal"><a href="#__codelineno-7-15">15</a></span>
<span class="normal"><a href="#__codelineno-7-16">16</a></span>
<span class="normal"><a href="#__codelineno-7-17">17</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1"></a><span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}]</span> <span class="o">|-</span> <span class="p">({}</span> <span class="mi">0</span><span class="p">)</span> <span class="err"></span> <span class="p">({},</span><span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">bConst</span><span class="p">)</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3"></a><span class="p">(</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">))</span> <span class="ow">in</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}</span>  <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">1</span><span class="p">]</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4"></a><span class="o">--------------------------------------------------------------</span><span class="p">(</span><span class="n">bApp</span><span class="p">)</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5"></a><span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}]</span> <span class="o">|-</span> <span class="p">({},</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="err"></span> <span class="p">({},</span><span class="mi">1</span><span class="p">)</span> 
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6"></a><span class="o">--------------------------------------------------------------------</span><span class="p">(</span><span class="n">bAssign</span><span class="p">)</span>    
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7"></a><span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="p">{},</span> <span class="n">z</span> <span class="o">=</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="err"></span> <span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">z</span><span class="p">:</span><span class="mi">1</span><span class="p">}],</span> <span class="p">{},</span> <span class="n">nop</span><span class="p">;</span>    
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8"></a><span class="o">-------------------------------------------------------------------------</span><span class="p">(</span><span class="n">bSeq</span><span class="p">)</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9"></a><span class="p">[{</span><span class="n">plus1</span><span class="p">,</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="p">{},</span> <span class="n">z</span> <span class="o">=</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span> <span class="k">return</span> <span class="n">z</span><span class="p">;</span> <span class="err"></span> <span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">z</span><span class="p">:</span><span class="mi">1</span><span class="p">}],</span> <span class="p">{},</span> <span class="k">return</span> <span class="n">z</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10"></a><span class="o">----------------------------------------------------------------------------</span> <span class="p">(</span><span class="n">bProg</span><span class="p">)</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11"></a><span class="p">[],{},</span> 
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12"></a><span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15"></a><span class="p">}</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16"></a><span class="n">z</span> <span class="o">=</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17"></a><span class="k">return</span> <span class="n">z</span><span class="p">;</span> <span class="err"></span> <span class="p">[{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">),</span> <span class="n">z</span><span class="p">:</span><span class="mi">1</span><span class="p">}],</span> <span class="p">{},</span> <span class="k">return</span> <span class="n">z</span>
</span></code></pre></div></td></tr></table></div>
<p>where sub derivation<code>[sub tree 1]</code> is as follows</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-8-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-8-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-8-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-8-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-8-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-8-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-8-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-8-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-8-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-8-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1"></a><span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}]</span> <span class="o">|-</span> <span class="p">({},</span> <span class="n">x</span><span class="p">)</span> <span class="err"></span> <span class="p">({},</span> <span class="mi">0</span><span class="p">)</span> <span class="p">(</span><span class="n">bVar</span><span class="p">)</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2"></a>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3"></a><span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}]</span> <span class="o">|-</span> <span class="p">({},</span> <span class="mi">1</span><span class="p">)</span> <span class="err"></span> <span class="p">({},</span> <span class="mi">1</span><span class="p">)</span> <span class="p">(</span><span class="n">bConst</span><span class="p">)</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4"></a><span class="o">------------------------------------------------------------</span> <span class="p">(</span><span class="n">bOp</span><span class="p">)</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5"></a><span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}]</span> <span class="o">|-</span> <span class="p">({},</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="err"></span> <span class="p">({},</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6"></a><span class="o">-------------------------------------------------------------------------</span><span class="p">(</span><span class="n">bAssign</span><span class="p">)</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7"></a><span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="p">{},</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="err"></span> <span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="n">nop</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8"></a><span class="o">---------------------------------------------------------------------------------------------</span><span class="p">(</span><span class="n">bSeq</span><span class="p">)</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9"></a><span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="p">{},</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">y</span><span class="p">;</span> 
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10"></a><span class="err"></span> <span class="p">[{</span><span class="n">x</span><span class="p">:</span><span class="mi">0</span><span class="p">,</span><span class="n">y</span><span class="p">:</span><span class="mi">1</span><span class="p">},</span> <span class="p">{</span><span class="n">plus1</span><span class="p">:</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="o">...</span><span class="p">)}],</span> <span class="p">{},</span> <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h4 id="cohort-exercise_1">Cohort Exercise<a class="headerlink" href="#cohort-exercise_1" title="Permanent link">&para;</a></h4>
<p>As an exercise, can you work out the derivation of "running" the program <code>SIMP2</code> using the big step operational semantics?</p>
<h2 id="simp-to-pa-conversion-extended">SIMP to PA conversion (Extended)<a class="headerlink" href="#simp-to-pa-conversion-extended" title="Permanent link">&para;</a></h2>
<p>We consider the update to the <a href="../ir_pseudo_assembly/#maximal-munch-algorithm-v2">maximal munch algorithm</a>. </p>
<div class="arithmatex">\[ 
\begin{array}{rc}
{\tt (m2App)} &amp; \begin{array}{c} 
          G_e(E_2) \vdash (\hat{e_2}, \check{e_2} ) \\ 
          t \ {\tt is\ a\ fresh\ variable} \\
          l \ {\tt is\ a\ fresh\ label} 
          \\ \hline
          G_e(f(E_2)) \vdash (t, \check{e_2} + [l: t\leftarrow call\ f\ \hat{e}]) 
          \end{array} 
\end{array}  
\]</div>
<p>The <span class="arithmatex">\({\tt (m2App)}\)</span> rule converts a function application expression to PA instructions.</p>
<div class="arithmatex">\[ 
\begin{array}{rc}
{\tt (m2ArrRef)} &amp; \begin{array}{c} 
          G_e(E_2) \vdash (\hat{e_2}, \check{e_2} ) \\ 
          t, t' \ {\tt are\ fresh\ variables} \\
          l, l' \ {\tt are\ fresh\ labels} 
          \\ \hline
          G_e(X[E_2]) \vdash (t', \check{e_2} + [l: t\leftarrow X + \hat{e_2}, l': t' \leftarrow deref\ t]) 
          \end{array} 
\end{array}  
\]</div>
<p>The <span class="arithmatex">\({\tt (m2ArrRef)}\)</span> rule converts an array reference expression to PA instructions.</p>
<div class="arithmatex">\[ 
\begin{array}{rc}
{\tt (m2ArrInst)} &amp; \begin{array}{c} 
          G_e(E_2) \vdash (\hat{e_2}, \check{e_2} ) \ \ \ c \ {\tt is\ the size\ of\ } T\\ 
          t, t' \ {\tt are\ fresh\ variables} \\
          l, l' \ {\tt are\ fresh\ labels} 
          \\ \hline
          G_e(T[E_2]) \vdash (t', \check{e_2} + [l: t\leftarrow c * \hat{e_2}, l': t' \leftarrow alloc\ t]) 
          \end{array} 
\end{array}  
\]</div>
<p>The <span class="arithmatex">\({\tt (m2ArrInst)}\)</span> rule converts an array instanstiation expression to PA instructions. Note that we assume that
we can assess the size of <span class="arithmatex">\(T\)</span> in bytes.</p>
<div class="arithmatex">\[ 
\begin{array}{rc}
{\tt (m2ArrDeref)} &amp; \begin{array}{c} 
          G_e(E_1) \vdash (\hat{e_1}, \check{e_2}) \ \ \ \ G_e(E_2) \vdash (\hat{e_2}, \check{e_2}) \\
          l, l'  {\tt\ are\ fresh\ labels}  \ \ \ t \ {\tt is\ a fresh\ variable} \\ \hline
          G_s(X[E_1] = E_2) \vdash \check{e_1} + \check{e_2} + [l: t \leftarrow X + \hat{e_1}, l': deref\ t\ \hat{e_2}]
          \end{array} 
\end{array}  
\]</div>
<p>The <span class="arithmatex">\({\tt (m2ArrDeref)}\)</span> rule converts an array derference assignment statement to PA instructions. </p>
<div class="arithmatex">\[ 
\begin{array}{rc}
{\tt (m2FuncDecl)} &amp; \begin{array}{c} 
          l  {\tt\ is\ a fresh\ label} \ \ \ G_s(\overline{S}) \vdash lis
          \\ \hline
          G_d(func\ f(X:T_1)T_2 \{\overline{S}\}) \vdash [l:begin\ f\ x] + lis 
          \end{array} 
\end{array}  
\]</div>
<p>The <span class="arithmatex">\({\tt (m2FuncDecl)}\)</span> rule converts a function declaration into PA instructions.</p>
<p>Applying the above algorithm to <code>SIMP1</code> yields <code>PA1</code> and applying to <code>SIMP2</code> produces <code>PA2</code>. </p>
<h2 id="extend-simp-type-checking">Extend SIMP Type checking<a class="headerlink" href="#extend-simp-type-checking" title="Permanent link">&para;</a></h2>
<p>We consider extending the <a href="../static_semantics/#type-checking-for-simp">static semantic (type checking)</a> of SIMP to support function and array.</p>
<h3 id="type-checking-simp-expression-extended">Type Checking SIMP Expression (Extended)<a class="headerlink" href="#type-checking-simp-expression-extended" title="Permanent link">&para;</a></h3>
<p>Let's consider the type checking rules for the new SIMP expressions. Overall the type rule shape remains unchanged. Recall</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tArrRef)} &amp; \begin{array}{c} 
          (X, [T]) \in \Gamma \ \ \ \ \Gamma \vdash E_2 : int
          \\ \hline
          \Gamma \vdash X[E_2] : T 
          \end{array} 
\end{array}  
\]</div>
<p>In the rule <span class="arithmatex">\((\tt tArrRef)\)</span> we type check memory reference expression. We validate <span class="arithmatex">\(X\)</span>'s type is an array type and <span class="arithmatex">\(E_2\)</span>'s type must be an <span class="arithmatex">\(int\)</span> type.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tArrInst)} &amp; \begin{array}{c} 
          \Gamma \vdash E_2 : int
          \\ \hline
          \Gamma \vdash T[E_2] : [T] 
          \end{array} 
\end{array}  
\]</div>
<p>The rule <span class="arithmatex">\((\tt tArrInst)\)</span> defines the type checking for array instantiation. The entire expression is of type <span class="arithmatex">\([T]\)</span> if the size argument <span class="arithmatex">\(E_2\)</span> is of type <span class="arithmatex">\(int\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tApp)} &amp; \begin{array}{c} 
          \Gamma \vdash f : T_1 \rightarrow T_2 \ \ \ \ \Gamma \vdash E_2 : T_1
          \\ \hline
          \Gamma \vdash f(E_2) : T_2
          \end{array} 
\end{array}  
\]</div>
<p>The rule <span class="arithmatex">\((\tt tApp)\)</span> defines the type checking for function application. The entire expression is of type 
<span class="arithmatex">\(T_2\)</span> if <span class="arithmatex">\(f\)</span> has type <span class="arithmatex">\(T_1 \rightarrow T_2\)</span> and <span class="arithmatex">\(E_2\)</span> has type <span class="arithmatex">\(T_1\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tUnit)} &amp; \begin{array}{c} 
          \Gamma \vdash unit : unit
          \end{array} 
\end{array}
\]</div>
<p>The rule <span class="arithmatex">\((\tt tUnit)\)</span> defines the type checking for unit value.</p>
<h3 id="type-checking-simp-statement-extended">Type Checking SIMP Statement (Extended)<a class="headerlink" href="#type-checking-simp-statement-extended" title="Permanent link">&para;</a></h3>
<p>For the extended SIMP statement type checking, we need to adjust the typing rules of shape <span class="arithmatex">\(\Gamma \vdash S\)</span> to <span class="arithmatex">\(\Gamma \vdash S : T\)</span>. </p>
<p>We adjust the typing rules for the standard statements as follows.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tAssign)} &amp; \begin{array}{c} 
          \Gamma \vdash E : T \ \ \ \ \Gamma \vdash X : T
          \\ \hline
          \Gamma \vdash X = E : unit
          \end{array} \\ \\ 
{\tt (tNop)} &amp; \begin{array}{c} 
          \Gamma \vdash nop : unit
          \end{array} \\ \\ 
{\tt (tReturn)} &amp; \begin{array}{c} 
          \Gamma \vdash X : T
          \\ \hline
          \Gamma \vdash return\ X: T
          \end{array} \\ \\ 
{\tt (tSeq)} &amp; \begin{array}{c} 
          \Gamma \vdash S : T \ \ \ \ \Gamma \vdash \overline{S}:T' 
          \\ \hline
          \Gamma \vdash S;\overline{S}: T'
          \end{array} \\ \\ 
{\tt (tIf)} &amp; \begin{array}{c} 
          \Gamma \vdash E : bool \ \ \ \ \Gamma \vdash \overline{S_1}:T \ \ \ \  \Gamma \vdash \overline{S_2}:T
          \\ \hline
          \Gamma \vdash if\ E\ \{\overline{S_1}\}\ else\ \{\overline{S_2}\}: T
          \end{array} \\ \\ 
{\tt (tWhile)} &amp; \begin{array}{c} 
          \Gamma \vdash E : bool \ \ \ \ \Gamma \vdash \overline{S}:T 
          \\ \hline
          \Gamma \vdash while\ E\ \{\overline{S}\} : T
          \end{array} \\ \\ 
\end{array} 
\]</div>
<p>The assignment statement and nop statement are of type <span class="arithmatex">\(unit\)</span>. The return statement  has type <span class="arithmatex">\(T\)</span> if the return variable <span class="arithmatex">\(X\)</span> has type <span class="arithmatex">\(T\)</span>. The head and the tail of a sequence of statements are typed indepdently. The two alternatives of an if statement should share the smae time. (In fact, we can be more specific to state that the type of if and while are <span class="arithmatex">\(unit\)</span>, though it is unnecessarily here.)</p>
<p>We turn into the typing for new syntax.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tFree)} &amp; \begin{array}{c} 
          \Gamma \vdash X : [T]
          \\ \hline
          \Gamma \vdash free\ X: unit
          \end{array}
\end{array}
\]</div>
<p>The free statement has type <span class="arithmatex">\(unit\)</span> provided the variable <span class="arithmatex">\(X\)</span> is having type <span class="arithmatex">\([T]\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tArrDeref)} &amp; \begin{array}{c} 
          \Gamma \vdash E_1 : int \ \ \ \ \Gamma \vdash X:[T] \ \ \ \Gamma \vdash E_2:T
          \\ \hline
          \Gamma \vdash X[E_1] = E_2: unit
          \end{array} 
\end{array}  
\]</div>
<p>The array dereference statement has type <span class="arithmatex">\(unit\)</span> if the index expression <span class="arithmatex">\(E_1\)</span> has type <span class="arithmatex">\(int\)</span>, <span class="arithmatex">\(X\)</span> has type <span class="arithmatex">\([T]\)</span> and the right hand side <span class="arithmatex">\(E_2\)</span> has type <span class="arithmatex">\(T\)</span>.</p>
<h3 id="type-checking-simp-declaration-extended">Type Checking SIMP Declaration (Extended)<a class="headerlink" href="#type-checking-simp-declaration-extended" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (tFuncDecl)} &amp; \begin{array}{c} 
          \Gamma \oplus(f:T_1 \rightarrow T_2)\oplus(X:T_1) \vdash \overline{S}:T_2
          \\ \hline
          \Gamma \vdash func\ f(X:T_1)T_2 \{ \overline{S} \}: T_1 \rightarrow T_2
          \end{array} \\ \\ 
{\tt (tProg)} &amp; \begin{array}{c} 
          {\tt for\ } i \in [1,n] \ \ \
          \Gamma_i \vdash D_i : T_i \ \ \
          \Gamma \vdash \overline{S}:T
          \\ \hline
          \Gamma \vdash D_1;...;D_n;\overline{S}: T
          \end{array} \
\end{array} 
\]</div>
<p>In rule <span class="arithmatex">\((\tt tFuncDecl)\)</span>, we type check the function declaration by extending the type environment with the type of <span class="arithmatex">\(f\)</span> and the formal argument <span class="arithmatex">\(X\)</span> and type check the body.
In rule <span class="arithmatex">\((\tt tProg)\)</span>, we type check the function declarations independently from the main program statement <span class="arithmatex">\(\overline{S}\)</span>.</p>
<h3 id="example">Example<a class="headerlink" href="#example" title="Permanent link">&para;</a></h3>
<p>We find the type checking derivation of the program <code>SIMP1</code></p>
<p>Let <code>1= {(y,int)}</code> and <code>={(plus1,int-&gt;int),(z,int)}</code>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-9-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-9-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-9-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-9-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-9-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-9-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-9-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-9-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-9-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-9-10">10</a></span>
<span class="normal"><a href="#__codelineno-9-11">11</a></span>
<span class="normal"><a href="#__codelineno-9-12">12</a></span>
<span class="normal"><a href="#__codelineno-9-13">13</a></span>
<span class="normal"><a href="#__codelineno-9-14">14</a></span>
<span class="normal"><a href="#__codelineno-9-15">15</a></span>
<span class="normal"><a href="#__codelineno-9-16">16</a></span>
<span class="normal"><a href="#__codelineno-9-17">17</a></span>
<span class="normal"><a href="#__codelineno-9-18">18</a></span>
<span class="normal"><a href="#__codelineno-9-19">19</a></span>
<span class="normal"><a href="#__codelineno-9-20">20</a></span>
<span class="normal"><a href="#__codelineno-9-21">21</a></span>
<span class="normal"><a href="#__codelineno-9-22">22</a></span>
<span class="normal"><a href="#__codelineno-9-23">23</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="mi">1</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">tConst</span><span class="p">)</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2"></a>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3"></a><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="err"></span> <span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4"></a><span class="o">-------------------------------------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="n">x</span> <span class="p">:</span><span class="nb">int</span>        <span class="p">(</span><span class="n">y</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="n">1</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6"></a><span class="o">-------------------------------------</span><span class="p">(</span><span class="n">tOp</span><span class="p">)</span> <span class="o">-----------------------------------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>       <span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span><span class="n">y</span><span class="p">:</span><span class="nb">int</span> 
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8"></a><span class="o">-----------------------------------------------------------------------------</span><span class="p">(</span><span class="n">tAssign</span><span class="p">)</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span><span class="n">unit</span>        <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">2</span><span class="p">]</span>                             
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10"></a><span class="o">-----------------------------------------------------------------------------------------</span> <span class="p">(</span><span class="n">tSeq</span><span class="p">)</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="k">return</span> <span class="n">y</span><span class="p">;:</span><span class="nb">int</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12"></a><span class="o">-------------------------------------------------------------</span> <span class="p">(</span><span class="n">tFuncDecl</span><span class="p">)</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13"></a><span class="n">1</span> <span class="o">|-</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">;</span>                            <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">3</span><span class="p">]</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16"></a><span class="p">}</span> <span class="p">:</span> <span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">int</span>         
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17"></a><span class="o">----------------------------------------------------------------------------</span> <span class="p">(</span><span class="n">tProg</span><span class="p">)</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18"></a><span class="n"></span> <span class="o">|-</span> <span class="n">func</span> <span class="n">plus1</span> <span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19"></a>    <span class="n">y</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-9-20"><a id="__codelineno-9-20" name="__codelineno-9-20"></a>    <span class="k">return</span> <span class="n">y</span><span class="p">;</span>
</span><span id="__span-9-21"><a id="__codelineno-9-21" name="__codelineno-9-21"></a><span class="p">}</span>
</span><span id="__span-9-22"><a id="__codelineno-9-22" name="__codelineno-9-22"></a><span class="n">z</span> <span class="o">=</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span><span id="__span-9-23"><a id="__codelineno-9-23" name="__codelineno-9-23"></a><span class="k">return</span> <span class="n">z</span><span class="p">;</span> <span class="p">:</span><span class="nb">int</span> 
</span></code></pre></div></td></tr></table></div></p>
<p>where [sub tree 2] is </p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-10-1">1</a></span>
<span class="normal"><a href="#__codelineno-10-2">2</a></span>
<span class="normal"><a href="#__codelineno-10-3">3</a></span>
<span class="normal"><a href="#__codelineno-10-4">4</a></span>
<span class="normal"><a href="#__codelineno-10-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1"></a><span class="n">y</span><span class="p">:</span><span class="nb">int</span> <span class="err"></span> <span class="n">1</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2"></a><span class="o">---------------------------------------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3"></a> <span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="n">y</span><span class="p">:</span><span class="nb">int</span> 
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4"></a><span class="o">-----------------------------------------------------------</span> <span class="p">(</span><span class="n">tReturn</span><span class="p">)</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5"></a><span class="n">1</span><span class="err"></span><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span><span class="err"></span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="o">|-</span> <span class="k">return</span> <span class="n">y</span><span class="p">;:</span><span class="nb">int</span>
</span></code></pre></div></td></tr></table></div>
<p>[sub tree 3] is</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-11-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-11-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-11-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-11-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-11-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-11-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-11-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-11-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-11-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-11-10">10</a></span>
<span class="normal"><a href="#__codelineno-11-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1"></a><span class="n"></span> <span class="o">|-</span> <span class="mi">0</span><span class="p">:</span><span class="nb">int</span> <span class="p">(</span><span class="n">tConst</span><span class="p">)</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2"></a>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3"></a><span class="p">(</span><span class="n">plus1</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)</span> <span class="err"></span> <span class="n"></span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4"></a><span class="o">----------------------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5"></a><span class="n"></span> <span class="o">|-</span> <span class="n">plus1</span><span class="p">:</span><span class="nb">int</span> <span class="o">-&gt;</span> <span class="nb">int</span>             <span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="err"></span> <span class="n"></span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6"></a><span class="o">--------------------------</span><span class="p">(</span><span class="n">tApp</span><span class="p">)</span>  <span class="o">-------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7"></a><span class="n"></span> <span class="o">|-</span> <span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">):</span><span class="nb">int</span>                 <span class="n"></span> <span class="o">|-</span> <span class="n">z</span><span class="p">:</span><span class="nb">int</span>       <span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="nb">int</span><span class="p">)</span> <span class="err"></span> <span class="n"></span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8"></a><span class="o">----------------------------------------</span><span class="p">(</span><span class="n">tAssign</span><span class="p">)</span>  <span class="o">-------</span><span class="p">(</span><span class="n">tVar</span><span class="p">)</span>
</span><span id="__span-11-9"><a id="__codelineno-11-9" name="__codelineno-11-9"></a><span class="n"></span> <span class="o">|-</span> <span class="n">z</span><span class="o">=</span><span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);:</span><span class="n">unit</span>                              <span class="n"></span> <span class="o">|-</span> <span class="n">z</span><span class="p">:</span><span class="nb">int</span>
</span><span id="__span-11-10"><a id="__codelineno-11-10" name="__codelineno-11-10"></a><span class="o">-----------------------------------------------------------</span> <span class="p">(</span><span class="n">tReturn</span><span class="p">)</span>
</span><span id="__span-11-11"><a id="__codelineno-11-11" name="__codelineno-11-11"></a><span class="n"></span> <span class="o">|-</span> <span class="n">z</span><span class="o">=</span><span class="n">plus1</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span><span class="k">return</span> <span class="n">z</span><span class="p">;:</span><span class="nb">int</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="cohort-exercise_2">Cohort Exercise<a class="headerlink" href="#cohort-exercise_2" title="Permanent link">&para;</a></h3>
<p>As an exercise, apply the type checking rule to <code>SIMP2</code>.</p>
<h3 id="cohort-exercise_3">Cohort Exercise<a class="headerlink" href="#cohort-exercise_3" title="Permanent link">&para;</a></h3>
<p>As an exercise, develop a type inference algorithm for the extended SIMP.</p>
<h2 id="run-time-errors-caused-by-illegal-memory-operations">Run-time errors caused by illegal memory operations<a class="headerlink" href="#run-time-errors-caused-by-illegal-memory-operations" title="Permanent link">&para;</a></h2>
<p>There are several issues arising with the memory management.</p>
<h3 id="double-freeing">Double-freeing<a class="headerlink" href="#double-freeing" title="Permanent link">&para;</a></h3>
<p>As motivated earlier, in some system, the operational semantics of the <code>free x</code> statement does not remove the variable <code>x</code> in the stack frame, which causes a double free error. For example</p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-12-1">1</a></span>
<span class="normal"><a href="#__codelineno-12-2">2</a></span>
<span class="normal"><a href="#__codelineno-12-3">3</a></span>
<span class="normal"><a href="#__codelineno-12-4">4</a></span>
<span class="normal"><a href="#__codelineno-12-5">5</a></span>
<span class="normal"><a href="#__codelineno-12-6">6</a></span>
<span class="normal"><a href="#__codelineno-12-7">7</a></span>
<span class="normal"><a href="#__codelineno-12-8">8</a></span>
<span class="normal"><a href="#__codelineno-12-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1"></a><span class="c1">// SIMP3 </span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2"></a><span class="n">func</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3"></a><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4"></a><span class="w">    </span><span class="n">free</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5"></a><span class="w">    </span><span class="n">free</span><span class="w"> </span><span class="n">t</span><span class="p">;</span><span class="w"> </span><span class="c1">// run-time error, as t&#39;s reference is no longer valid.</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">x</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7"></a><span class="p">}</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9"></a><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="missing-free">Missing free<a class="headerlink" href="#missing-free" title="Permanent link">&para;</a></h3>
<p>On the other hand, missing free statement after array initialization might cause memory leak. </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-13-1">1</a></span>
<span class="normal"><a href="#__codelineno-13-2">2</a></span>
<span class="normal"><a href="#__codelineno-13-3">3</a></span>
<span class="normal"><a href="#__codelineno-13-4">4</a></span>
<span class="normal"><a href="#__codelineno-13-5">5</a></span>
<span class="normal"><a href="#__codelineno-13-6">6</a></span>
<span class="normal"><a href="#__codelineno-13-7">7</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1"></a><span class="c1">// SIMP4</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2"></a><span class="n">func</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3"></a><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span><span class="w"> </span><span class="c1">// unfreed memory unless garbage-collected.</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5"></a><span class="p">}</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7"></a><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<h3 id="array-out-of-bound">Array out of bound<a class="headerlink" href="#array-out-of-bound" title="Permanent link">&para;</a></h3>
<p>Another common error is array out of bound access. </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-14-1">1</a></span>
<span class="normal"><a href="#__codelineno-14-2">2</a></span>
<span class="normal"><a href="#__codelineno-14-3">3</a></span>
<span class="normal"><a href="#__codelineno-14-4">4</a></span>
<span class="normal"><a href="#__codelineno-14-5">5</a></span>
<span class="normal"><a href="#__codelineno-14-6">6</a></span>
<span class="normal"><a href="#__codelineno-14-7">7</a></span>
<span class="normal"><a href="#__codelineno-14-8">8</a></span>
<span class="normal"><a href="#__codelineno-14-9">9</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1"></a><span class="c1">// SIMP5</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2"></a><span class="n">func</span><span class="w"> </span><span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3"></a><span class="w">    </span><span class="n">t</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kt">int</span><span class="o">[</span><span class="n">x</span><span class="o">]</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4"></a><span class="w">    </span><span class="n">t</span><span class="o">[</span><span class="mi">1</span><span class="o">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="c1">// array out of bound might arise</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5"></a><span class="w">    </span><span class="n">free</span><span class="w"> </span><span class="n">t</span><span class="p">;</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7"></a><span class="p">}</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">f</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9"></a><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<p>Note that all these three examples are well-typed in the current type checking system. The array out of bound error can be detected via dependent type system (recall GADT example in <a href="../fp_scala_poly/#generalized-algebraic-data-type">some earlier class</a>). The other two kinds of errors can be flagged out using Linear Type system.</p>
<h2 id="linear-type-system">Linear Type System<a class="headerlink" href="#linear-type-system" title="Permanent link">&para;</a></h2>
<p>Linear Type was inspired by the linear logic proposed by Jean-Yves Girard. </p>
<p>Linear Type System is a popular static semantic design choice to ensure memory safety. It has strong influences in languages such as Cyclone and Rust. </p>
<p>The basic principal is that </p>
<ol>
<li>each variable has only one entry in a type environment <span class="arithmatex">\(\Gamma\)</span> (same as the normal type system)</li>
<li>after a variable's type assignment from some type environment <span class="arithmatex">\(\Gamma\)</span> is used in some proof derivation, it will be removed from <span class="arithmatex">\(\Gamma\)</span>. </li>
</ol>
<h3 id="type-checking-expression-using-linear-type-system">Type Checking Expression using Linear Type System<a class="headerlink" href="#type-checking-expression-using-linear-type-system" title="Permanent link">&para;</a></h3>
<p>The linear typing rules for SIMP expression are in the form of <span class="arithmatex">\(\Gamma \vdash E : T, \Gamma'\)</span> which reads as "we type check <span class="arithmatex">\(E\)</span> to have type <span class="arithmatex">\(T\)</span> under <span class="arithmatex">\(\Gamma\)</span>, after that <span class="arithmatex">\(\Gamma\)</span> becomes <span class="arithmatex">\(\Gamma'\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltVar)} &amp; \begin{array}{c} 
          \Gamma'\oplus(X,T) = \Gamma
          \\ \hline
          \Gamma \vdash X : T, \Gamma' 
          \end{array} 
\end{array}
\]</div>
<p>The above rule type checks the variable <span class="arithmatex">\(X\)</span> to have type <span class="arithmatex">\(T\)</span>, this is valid if we can find <span class="arithmatex">\((X,T)\)</span> in the type environment <span class="arithmatex">\(\Gamma\)</span>, and we remove that entry from <span class="arithmatex">\(\Gamma\)</span> to produce <span class="arithmatex">\(\Gamma'\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltArrInst)} &amp; \begin{array}{c} 
          \Gamma \vdash E:int, \Gamma'
          \\ \hline
          \Gamma \vdash T[E] : [T], \Gamma' 
          \end{array} 
\end{array}
\]</div>
<p>The array instantion expression is treated as before except that the post-checking type environment is taken into consideration. </p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltApp)} &amp; \begin{array}{c} 
          \Gamma \vdash E_2:T_1, \Gamma' \ \ \ \ (f, T_1\rightarrow T_2) \in \Gamma'
          \\ \hline
          \Gamma \vdash f(E_2) : T_2, \Gamma' 
          \end{array}  
\end{array}
\]</div>
<p>When type checking the function application expression, we linearly type-check the argument <span class="arithmatex">\(E_2\)</span> to have type <span class="arithmatex">\(T_1\)</span> and we check the function <span class="arithmatex">\(f\)</span> is having the function type <span class="arithmatex">\(T_1 \rightarrow T_2)\)</span> in the update type environment. (Note that unlike other system, we do not remove the type assignment for functions after "use", so that a function can be reused.)</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltArrRef)} &amp; \begin{array}{c} 
          \Gamma \vdash E_2:int, \Gamma' \ \ \ \ (X, [T]) \in \Gamma'
          \\ \hline
          \Gamma \vdash X[E_2] : T, \Gamma' 
          \end{array}  
\end{array}
\]</div>
<p>Similarly, when type checking the array reference expression, we linearly type check the index expression against type <span class="arithmatex">\(int\)</span>, and we check the array variable <span class="arithmatex">\(X\)</span> is in the type environment <span class="arithmatex">\(\Gamma'\)</span> without removing it. </p>
<p>We omit the linearly typing rules for the rest of expressions as they contain no surprise. </p>
<h4 id="cohort-exercise_4">Cohort Exercise<a class="headerlink" href="#cohort-exercise_4" title="Permanent link">&para;</a></h4>
<p>Work out the linear typing rules for <span class="arithmatex">\(C\)</span>, <span class="arithmatex">\(unit\)</span>, <span class="arithmatex">\((E)\)</span> and <span class="arithmatex">\(E\ op\ E\)</span>.</p>
<h3 id="type-checking-statement-using-linear-type-system">Type Checking Statement using Linear Type System<a class="headerlink" href="#type-checking-statement-using-linear-type-system" title="Permanent link">&para;</a></h3>
<p>The linear typing rules for SIMP statements are in the form of <span class="arithmatex">\(\Gamma \vdash S : T, \Gamma'\)</span> which reads as "we type check <span class="arithmatex">\(S\)</span> to have type <span class="arithmatex">\(T\)</span> under <span class="arithmatex">\(\Gamma\)</span>, after that <span class="arithmatex">\(\Gamma\)</span> becomes <span class="arithmatex">\(\Gamma'\)</span>.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltAssign)} &amp; \begin{array}{c} 
          \Gamma \vdash E:T, \Gamma' 
          \\ \hline
          \Gamma \vdash X = E : unit, \Gamma' \oplus(X,T) 
          \end{array} 
\end{array}
\]</div>
<p>In rule <span class="arithmatex">\((\tt ltAssign)\)</span> we type check the assignment statement, we first type check the RHS expression, and we "transfer" the ownership of type <span class="arithmatex">\(T\)</span> to <span class="arithmatex">\(X\)</span> in the resulting environment. For example, in an assignment statement, <span class="arithmatex">\(X = Y\)</span>, <span class="arithmatex">\(Y\)</span>'s type is transferred to <span class="arithmatex">\(X\)</span>, and <span class="arithmatex">\(Y\)</span>'s type assignment is no longer accessible after this statement. Hence the following programming is not typeable in the linear type system. </p>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-15-1">1</a></span>
<span class="normal"><a href="#__codelineno-15-2">2</a></span>
<span class="normal"><a href="#__codelineno-15-3">3</a></span>
<span class="normal"><a href="#__codelineno-15-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1"></a><span class="c1">// SIMP6</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2"></a><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3"></a><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4"></a><span class="n">z</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span></code></pre></div></td></tr></table></div>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltNop)} &amp; 
          \Gamma \vdash nop : unit, \Gamma 
\end{array}
\]</div>
<p>Typing <span class="arithmatex">\(Nop\)</span> does not change the type environment.  </p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltArrDeref)} &amp; \begin{array}{c} 
          \Gamma \vdash E_2:T, \Gamma_1 \ \ \ \Gamma_1 \vdash E_1:int, \Gamma_2 \\ (X,[T]) \in \Gamma_2 
          \\ \hline
          \Gamma \vdash X[E_1] = E_2 : unit, \Gamma_2
          \end{array} 
\end{array}
\]</div>
<p>In case of array dereference statement, we type check the RHS expression. With the updated type environemnt <span class="arithmatex">\(Gamma_1\)</span> we type check the index expression <span class="arithmatex">\(E_1\)</span> having type <span class="arithmatex">\(int\)</span>. Finally we make sure that <span class="arithmatex">\(X\)</span> is an array type in <span class="arithmatex">\(\Gamma_2\)</span> without removing it.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltFree)} &amp; \begin{array}{c} 
          \Gamma \vdash X:[T], \Gamma' 
          \\ \hline
          \Gamma \vdash free\ X: unit, \Gamma'
          \end{array} 
\end{array}
\]</div>
<p>When type checking the free statement, <span class="arithmatex">\(X\)</span>'s type must be an array type. (Note that <span class="arithmatex">\((X,[T]))\)</span> will be removed.)</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltReturn)} &amp; \begin{array}{c} 
          \Gamma \vdash X:T, \Gamma' 
          \\ \hline
          \Gamma \vdash return\ X: T, \Gamma'
          \end{array} 
\end{array}
\]</div>
<p>Return statement carries the type of the variable being returned. After that, the type assignment of <span class="arithmatex">\(X\)</span> will be removed. </p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltIf)} &amp; \begin{array}{c} 
          \Gamma \vdash E_1:bool, \Gamma_1 \\ 
          \Gamma_1 \vdash \overline{S_1} : T, \Gamma_2 \\  
          \Gamma_1 \vdash \overline{S_2} : T, \Gamma_2 
          \\ \hline
          \Gamma \vdash if\ E_1\ \{\overline{S_1}\}\ else\ \{\overline{S_2}\} : T, \Gamma_2
          \end{array} 
\end{array}
\]</div>
<p>In the rule <span class="arithmatex">\((\tt ltIf)\)</span>, we first type check the condition expression <span class="arithmatex">\(E_1\)</span> against <span class="arithmatex">\(bool\)</span>. We then type check the then and else statements under the same type <span class="arithmatex">\(T\)</span> and resulting type environment <span class="arithmatex">\(\Gamma_2\)</span>. </p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltWhile)} &amp; \begin{array}{c} 
          \Gamma \vdash E:bool, \Gamma_1 \\ 
          \Gamma_1 \vdash \overline{S} : T, \Gamma_1  
          \\ \hline
          \Gamma \vdash while\ E\ \{\overline{S}\} : T, \Gamma_1
          \end{array} 
\end{array}
\]</div>
<p>The typing rule <span class="arithmatex">\((\tt ltWhile)\)</span> is similar to <span class="arithmatex">\((\tt ltIf)\)</span>, except that the type environments "before" and "after" the while body should be unchanged to ensure linearity.</p>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltSeq)} &amp; \begin{array}{c} 
          \Gamma \vdash S:T, \Gamma_1 \\ 
          \Gamma_1 \vdash \overline{S} : T', \Gamma_2  
          \\ \hline
          \Gamma \vdash S;\overline{S}:T', \Gamma_2
          \end{array} 
\end{array}
\]</div>
<p>In the rule <span class="arithmatex">\((\tt ltSeq)\)</span>, we type check a sequence of statements by propogating the updated type environments from top to bottom (left to right).</p>
<h3 id="type-checking-simp-declaration-using-linear-type-system">Type Checking SIMP Declaration using Linear Type System<a class="headerlink" href="#type-checking-simp-declaration-using-linear-type-system" title="Permanent link">&para;</a></h3>
<div class="arithmatex">\[
\begin{array}{rc}
{\tt (ltFuncDecl)} &amp; \begin{array}{c} 
          \Gamma \oplus(f:T_1 \rightarrow T_2)\oplus(X:T_1) \vdash \overline{S}:T_2, \Gamma\oplus(f:T_1 \rightarrow T_2)
          \\ \hline
          \Gamma \vdash func\ f(X:T_1)T_2 \{ \overline{S} \}: T_1 \rightarrow T_2, \Gamma
          \end{array} \\ \\ 
{\tt (ltProg)} &amp; \begin{array}{c} 
          {\tt for\ } i \in [1,n] \ \ \
          \{\} \vdash D_i : T_i, \Gamma_i \ \ \
          \Gamma \vdash \overline{S}:T,\Gamma'
          \\ \hline
          \Gamma \vdash D_1;...;D_n;\overline{S}: T,\Gamma'
          \end{array} 
\end{array} 
\]</div>
<p>When type checking a function declaration, we extend the type environemnt with the function's type assignment and its argument type assignment, then type check the body. The additional requirement is that the resulting environment must be exactly the same as <span class="arithmatex">\(\Gamma\oplus(f:T_1 \rightarrow T_2)\)</span> to maintain linearity. </p>
<p>In <span class="arithmatex">\((\tt ltPRog)\)</span>, we type check the function declaration idependently with an empty type environment then type check the main statement sequence left to right. </p>
<h4 id="rejecting-simp3-via-linear-type-system">Rejecting <code>SIMP3</code> via linear type system<a class="headerlink" href="#rejecting-simp3-via-linear-type-system" title="Permanent link">&para;</a></h4>
<p>Let's apply the linear type checking rules type check the function <code>f</code> from  our earlier example <code>SIMP3</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-16-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-16-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-16-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-16-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-16-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-16-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-16-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-16-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-16-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-16-10">10</a></span>
<span class="normal"><a href="#__codelineno-16-11">11</a></span>
<span class="normal"><a href="#__codelineno-16-12">12</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">(</span><span class="n">ltVar</span><span class="p">),</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span> <span class="p">(</span><span class="n">ltVar</span><span class="p">)</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2"></a><span class="o">--------------------------------------------------------</span><span class="p">(</span><span class="n">ltAssign</span><span class="p">)</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">:</span><span class="n">unit</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">5</span><span class="p">]</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4"></a><span class="o">-----------------------------------------------------------------</span><span class="p">(</span><span class="n">ltSeq</span><span class="p">)</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="n">free</span> <span class="n">t</span><span class="p">;</span> <span class="n">free</span> <span class="n">t</span><span class="p">;</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">:</span> <span class="err">???</span><span class="p">,</span> <span class="err">???</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6"></a><span class="o">-----------------------------------------------------</span> <span class="p">(</span><span class="n">ltFuncDecl</span><span class="p">)</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7"></a><span class="p">{}</span> <span class="o">|-</span> <span class="n">func</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8"></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9"></a>    <span class="n">free</span> <span class="n">t</span><span class="p">;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10"></a>    <span class="n">free</span> <span class="n">t</span><span class="p">;</span> 
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11"></a>    <span class="k">return</span> <span class="n">x</span><span class="p">;</span> 
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12"></a><span class="p">}</span> <span class="p">:</span> <span class="err">???</span><span class="p">,</span> <span class="err">???</span>
</span></code></pre></div></td></tr></table></div>
<p>[sub tree 5] is as follows</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-17-1">1</a></span>
<span class="normal"><a href="#__codelineno-17-2">2</a></span>
<span class="normal"><a href="#__codelineno-17-3">3</a></span>
<span class="normal"><a href="#__codelineno-17-4">4</a></span>
<span class="normal"><a href="#__codelineno-17-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="o">|-</span> <span class="n">t</span> <span class="p">:</span> <span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span> <span class="p">(</span><span class="n">ltVar</span><span class="p">)</span> 
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2"></a><span class="o">-----------------------------------------------------------</span> <span class="p">(</span><span class="n">ltFree</span><span class="p">)</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="o">|-</span> <span class="n">free</span> <span class="n">t</span> <span class="p">:</span> <span class="n">unit</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span>   <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">6</span><span class="p">]</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4"></a><span class="o">----------------------------------------------------------</span> <span class="p">(</span><span class="n">ltSeq</span><span class="p">)</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="o">|-</span> <span class="n">free</span> <span class="n">t</span><span class="p">;</span> <span class="n">free</span> <span class="n">t</span><span class="p">;</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">:</span> <span class="err">???</span><span class="p">,</span> <span class="err">???</span>
</span></code></pre></div></td></tr></table></div>
<p>[sub tree 6] is as follows</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-18-1">1</a></span>
<span class="normal"><a href="#__codelineno-18-2">2</a></span>
<span class="normal"><a href="#__codelineno-18-3">3</a></span>
<span class="normal"><a href="#__codelineno-18-4">4</a></span>
<span class="normal"><a href="#__codelineno-18-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1"></a><span class="n">we</span> <span class="n">get</span> <span class="n">stuck</span> <span class="n">here</span><span class="o">.</span> <span class="n">t</span><span class="s1">&#39;s type has been &quot;consumed&quot; </span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2"></a><span class="o">----------------------------</span> <span class="p">(</span><span class="n">ltFree</span><span class="p">)</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">free</span> <span class="n">t</span> <span class="p">:</span> <span class="err">???</span><span class="p">,</span> <span class="err">???</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4"></a><span class="o">--------------------------------------------</span> <span class="p">(</span><span class="n">ltSeq</span><span class="p">)</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">free</span> <span class="n">t</span><span class="p">;</span> <span class="k">return</span> <span class="n">x</span><span class="p">;</span> <span class="p">:</span> <span class="err">???</span><span class="p">,</span> <span class="err">???</span>
</span></code></pre></div></td></tr></table></div>
<p>Since the type checking fails, <code>SIMP3</code> will be rejected by the linear type system. </p>
<h4 id="rejecting-simp4-via-linear-type-system">Rejecting <code>SIMP4</code> via linear type system<a class="headerlink" href="#rejecting-simp4-via-linear-type-system" title="Permanent link">&para;</a></h4>
<p>Let's try to type check <code>SIMP4</code>.</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-19-1"> 1</a></span>
<span class="normal"><a href="#__codelineno-19-2"> 2</a></span>
<span class="normal"><a href="#__codelineno-19-3"> 3</a></span>
<span class="normal"><a href="#__codelineno-19-4"> 4</a></span>
<span class="normal"><a href="#__codelineno-19-5"> 5</a></span>
<span class="normal"><a href="#__codelineno-19-6"> 6</a></span>
<span class="normal"><a href="#__codelineno-19-7"> 7</a></span>
<span class="normal"><a href="#__codelineno-19-8"> 8</a></span>
<span class="normal"><a href="#__codelineno-19-9"> 9</a></span>
<span class="normal"><a href="#__codelineno-19-10">10</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">x</span> <span class="p">:</span> <span class="nb">int</span> <span class="p">(</span><span class="n">ltVar</span><span class="p">),</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">)}</span> <span class="p">(</span><span class="n">ltVar</span><span class="p">)</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2"></a><span class="o">--------------------------------------------------------</span><span class="p">(</span><span class="n">ltAssign</span><span class="p">)</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="p">:</span><span class="n">unit</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="p">[</span><span class="n">sub</span> <span class="n">tree</span> <span class="mi">7</span><span class="p">]</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4"></a><span class="o">-----------------------------------------------------------------</span><span class="p">(</span><span class="n">ltSeq</span><span class="p">)</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">x</span><span class="p">,</span><span class="nb">int</span><span class="p">)}</span> <span class="o">|-</span> <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">];</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;:</span><span class="nb">int</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="n">we</span> <span class="n">get</span> <span class="n">stuck</span>  
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6"></a><span class="o">-----------------------------------------------------</span> <span class="p">(</span><span class="n">ltFuncDecl</span><span class="p">)</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7"></a><span class="p">{}</span> <span class="o">|-</span> <span class="n">func</span> <span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="nb">int</span> <span class="p">{</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8"></a>    <span class="n">t</span> <span class="o">=</span> <span class="nb">int</span><span class="p">[</span><span class="n">x</span><span class="p">];</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9"></a>    <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10"></a><span class="p">}</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="err">???</span> 
</span></code></pre></div></td></tr></table></div>
<p>where [sub tree 7] is as follows</p>
<div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-20-1">1</a></span>
<span class="normal"><a href="#__codelineno-20-2">2</a></span>
<span class="normal"><a href="#__codelineno-20-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="o">|-</span> <span class="mi">1</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2"></a><span class="o">-----------------------------------------------------</span> <span class="p">(</span><span class="n">ltReturn</span><span class="p">)</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3"></a><span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span> <span class="o">|-</span> <span class="k">return</span> <span class="mi">1</span><span class="p">;</span> <span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="p">{(</span><span class="n">f</span><span class="p">,</span><span class="nb">int</span><span class="o">-&gt;</span><span class="nb">int</span><span class="p">),(</span><span class="n">t</span><span class="p">,[</span><span class="nb">int</span><span class="p">])}</span>
</span></code></pre></div></td></tr></table></div>
<p>The above program fails to type check as the result type environment of the <span class="arithmatex">\((\tt ltFuncDelc)\)</span> rule is not matching with the input type environment. </p>
<h3 id="make-linear-type-system-practical">Make linear type system practical<a class="headerlink" href="#make-linear-type-system-practical" title="Permanent link">&para;</a></h3>
<p>The linear type checking is a proof-of-concept that we could use it to detect run-time errors related to memory management. </p>
<p>The current system is still naive. </p>
<ol>
<li>We probably need to apply the linearity restriction to heap object such as array but not to primitive values such as <code>int</code> and <code>bool</code>. For example, the following program will not type check</li>
</ol>
<div class="language-java highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-21-1">1</a></span>
<span class="normal"><a href="#__codelineno-21-2">2</a></span>
<span class="normal"><a href="#__codelineno-21-3">3</a></span>
<span class="normal"><a href="#__codelineno-21-4">4</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1"></a><span class="n">func</span><span class="w"> </span><span class="nf">square</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="kt">int</span><span class="p">):</span><span class="kt">int</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2"></a><span class="w">    </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">y</span><span class="p">;</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4"></a><span class="p">}</span>
</span></code></pre></div></td></tr></table></div>
<ol>
<li>
<p>Typing rules will become complex if we consider nested arrays. </p>
</li>
<li>
<p>We need a type inference algorithm, which should reject <code>SIMP3</code>. But for <code>SIMP4</code>, its type constraints should identify the missing <code>free</code> statement and let the compiler insert the statement on behalf of the programmers. </p>
</li>
</ol>
<p>We leave these as future work. </p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.annotate", "content.code.copy", "navigation.expand", "navigation.indexes", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.1e8ae164.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>